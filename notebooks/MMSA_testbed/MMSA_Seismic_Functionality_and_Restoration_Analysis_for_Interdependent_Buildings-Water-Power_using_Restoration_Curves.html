

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>MMSA: Seismic Functionality and Restoration Analysis for Interdependent Buildings-Water-Power using Restoration Curves &#8212; IN-CORE Manual&lt;br /&gt;&lt;span style=&#39;color:grey;font-size:smaller;&#39;&gt;4.6.0&lt;span&gt;</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=c5ced968eda925caa686" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=c5ced968eda925caa686"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/MMSA_testbed/MMSA_Seismic_Functionality_and_Restoration_Analysis_for_Interdependent_Buildings-Water-Power_using_Restoration_Curves';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Other Examples" href="../../notebooks_other.html" />
    <link rel="prev" title="MMSA: Seismic Functionality Analysis for Interdependent Buildings-Water-Power using Fragility and Repair Rate Curves" href="MMSA_Seismic_Functionality_Analysis_for_Interdependent_Buildings-Water-Power_using_Fragility_and_Repair_Rate_Curves.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../introduction.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/resilience-logo.png" class="logo__image only-light" alt="IN-CORE Manual<br /><span style='color:grey;font-size:smaller;'>4.6.0<span> - Home"/>
    <script>document.write(`<img src="../../_static/resilience-logo.png" class="logo__image only-dark" alt="IN-CORE Manual<br /><span style='color:grey;font-size:smaller;'>4.6.0<span> - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../introduction.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../account.html">IN-CORE Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../pyincore.html">pyIncore</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pyincore/quick_reference.html">Quick Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pyincore/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pyincore/install_pyincore.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pyincore_upgrade.html">pyIncore Upgrade Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pyincore/running.html">Testing and Running</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../analyses.html">Analyses</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/bridge_dmg.html">Bridge damage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/building_dmg.html">Building damage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/building_func.html">Building functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/building_loss.html">Building Economic Loss</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/capital_shocks.html">Capital shocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/combined_wind_wave_surge_building_dmg.html">Combined wind, wave, surge building damage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/cumulative_building_dmg.html">Cumulative building damage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/epf_dmg.html">Electric power facility damage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/epf_restoration.html">Electric power facility restoration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/epn_functionality.html">EPN functionality analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/housing_household_recovery.html">Household-level housing sequential recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/housing_recovery.html">Housing recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/housingunitallocation.html">Housing unit allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/joplin_cge.html">Joplin Computable General Equilibrium (CGE)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/joplin_empirical_restoration.html">Joplin empirical restoration model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/mean_dmg.html">Mean damage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/multi_retrofit_optimization.html">Multi-objective retrofit optimization model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/mc_failure_prob.html">Monte Carlo failure probability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/nci_functionality.html">Network cascading interdependency functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/non_structural_building_dmg.html">Nonstructural building damage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/pipeline_dmg.html">Pipeline damage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/pipeline_dmg_w_repair_rate.html">Pipeline damage with repair rate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/pipeline_functionality.html">Pipeline functionality analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/pipeline_restoration.html">Pipeline restoration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/populationdislocation.html">Population dislocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/portfolio_recovery.html">Portfolio recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/residential_building_recovery.html">Residential building recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/road_dmg.html">Road damage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/seaside_cge.html">Seaside Computable General Equilibrium (CGE)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/social_vulnerability.html">Social vulnerability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/tornadoepn_dmg.html">Tornado electric power network (EPN) damage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/transportation_recovery.html">Transportation recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/waterfacility_dmg.html">Water facility damage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/wfn_functionality.html">Water network functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../analyses/water_facility_restoration.html">Water facility restoration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pyincore_viz.html">pyIncore viz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pyincore_data.html">pyIncore data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../incore_lab.html">IN-CORE Lab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../webtools.html">IN-CORE Web Tools</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials.html">Tutorials and Tips</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../create_dataset/create_dataset.html">Create and Use Dataset Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../create_dfr3_object/create_dfr3_object.html">Create  DFR3 and Mapping Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../create_earthquake/create_earthquake.html">Create Earthquakes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../create_tornado/create_tornado.html">Create Tornadoes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../retrofit_plan_Joplin_2021_12_01/retrofit_plan_Joplin_2021_12_01.html">An example of Joplin tornado scenario analysis with Joplin retrofit plan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../create_network_dataset/create_network_dataset.html">Create Network Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../create_local_hazard/create_local_hazard.html">Create Local Hazards</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently asked questions</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../workshops.html">IN-CORE workshops</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../workshops/20210526/agenda.html">Workshop May 26, 2021</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../workshops/20210526/session2/session2-hazard.html">Session 2: working with Hazards (Tornado and Earthquake)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../workshops/20210526/session2/session2-assignment.html">Session 2: Assignment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../workshops/20210526/session2/session2-assignment-answer.html">Session 2: Assignment Answer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../workshops/20210526/session3/session3-damage-analysis.html">Session 3: Damage analysis (buildings and electric power facilities)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../workshops/20210526/session3/session3-assignment.html">Session 3: Assignment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../workshops/20210526/session3/session3-assignment-answer.html">Session 3: Assignment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../workshops/20210526/session4/session4-viz.html">Session 4: Visualization of outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../workshops/20210526/session4/session4-assignment.html">Session 4: Assignment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../workshops/20210526/session4/session4-assignment-answer.html">Session 4: Assignment explanation and answers</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../workshops/20220131/agenda.html">Lifeline workshop January 31, 2022</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../workshops/20220131/session1/session1-jupyter-intro.html">Session 1: Introduction to Jupyter Notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../workshops/20220131/session2/session2-hazard.html">Session 2: Working with Hazards (Tornado and Earthquake)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../workshops/20220131/session3/session3-building_damage_analysis.html">Session 3: Building Damage Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../workshops/20220131/session4/session4-damage-analyses-lifelines.html">Session 4: Damage Analyses on Lifelines</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../../notebooks.html">Example Notebooks</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Galveston_testbed/Galveston_testbed.html">Galveston Testbed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Joplin_testbed/Joplin_testbed.html">Joplin Tornado Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Lumberton_testbed/Lumberton_testbed.html">Lumberton Testbed</a></li>

<li class="toctree-l2"><a class="reference internal" href="../Seaside_testbed/Seaside_testbed.html">Seaside Example Notebook 1: Multi-Hazard Building Damage</a></li>
<li class="toctree-l2"><a class="reference internal" href="MMSA_Seismic_Functionality_Analysis_for_Interdependent_Buildings-Water-Power_using_Fragility_and_Repair_Rate_Curves.html">MMSA: Seismic Functionality Analysis for Interdependent Buildings-Water-Power using Fragility and Repair Rate Curves</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">MMSA: Seismic Functionality and Restoration Analysis for Interdependent Buildings-Water-Power using Restoration Curves</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../notebooks_other.html">Other Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../refs.html">Technical References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../links.html">Useful links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contact Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgement.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../termsofservice.html">IN-CORE Terms of Service</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/MMSA_testbed/MMSA_Seismic_Functionality_and_Restoration_Analysis_for_Interdependent_Buildings-Water-Power_using_Restoration_Curves.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>MMSA: Seismic Functionality and Restoration Analysis for Interdependent Buildings-Water-Power using Restoration Curves</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">MMSA: Seismic Functionality and Restoration Analysis for Interdependent Buildings-Water-Power using Restoration Curves</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#define-earthquake-hazard-scenarios">1) Define Earthquake Hazard Scenarios</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#define-infrastructure-inventory-data">2) Define Infrastructure Inventory Data</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-inventory-data">2-1) Building Inventory Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#structural-system-type-statistics-of-mmsa-building-inventory">Structural system type statistics of MMSA building inventory</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#electric-power-network-epn-inventory-data">2-2) Electric Power Network (EPN) Inventory Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#water-distribution-system-wds-inventory-data">2-3) Water Distribution System (WDS) Inventory Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#epn-service-area-dataset">2-4) EPN service area dataset</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#infrastructure-damage-analysis">3) Infrastructure Damage Analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#buildings-physical-damage-mc-and-functionality-analysis">3-1) Buildings Physical Damage, MC and Functionality Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-damage-analysis">3-1-A) Damage Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#note-the-building-damage-analysis-results-subject-to-mw7-1-is-imported-from-a-csv-file-but-for-the-final-release-the-previous-code-cells-can-be-uncommented-and-use-for-damage-analysis">Note: The building damage analysis results subject to Mw7.1 is imported from a CSV file but for the final release the previous code cells can be uncommented and use for damage analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b-monte-carlo-simulation">3-1-B) Monte Carlo Simulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c-functionality-analysis-buildings-only">3-1-C) Functionality Analysis (Buildings Only)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#electric-power-network-epn-analysis">3-2) Electric Power Network (EPN) Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-epn-damage-analysis">3-2-A) EPN Damage Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b-epn-monte-carlo-analysis">3-2-B) EPN Monte Carlo Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#water-distribution-system-analysis">3-3) Water Distribution System Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-water-facility-wf-damage-analysis">3-3-A) Water Facility (WF) Damage Analysis</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#b-water-facility-wf-mc-simulations">3-3-B) Water Facility (WF) MC Simulations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#c-pipeline-damage-and-servicability-analysis">3-3-C) Pipeline Damage and Servicability Analysis</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#restoration-and-functionality-analysis">4) Restoration and Functionality Analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#networkx-modeling-of-epn-and-wds-networks">4-1) NetworkX Modeling of EPN and WDS networks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#restoration-analysis-of-epn-components">4-2) Restoration Analysis of EPN Components</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#restoration-analysis-of-wds-components">4-3) Restoration Analysis of WDS Components</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#networkx-modeling-of-interdependent-epn-and-wds-networks">4-4) NetworkX modeling of interdependent EPN and WDS networks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-the-epn-and-wds-pecentage-functionality-dataframes-are-combined-in-this-section-to-obtain-an-interdependent-networkx-model-of-epn-and-wds">4-4-A) The EPN and WDS pecentage functionality dataframes are combined in this section to obtain an interdependent networkX model of EPN and WDS.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b-assign-si-values-obtained-from-pipeline-repair-analysis-as-weight-to-networkx-model">4-4-B) Assign SI values obtained from pipeline repair analysis as weight to networkX model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c-define-the-dependency-between-epn-and-wds-with-additional-edges-within-the-networkx-model">4-4-C) Define the dependency between EPN and WDS with additional edges within the networkX model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implemention-of-an-input-output-model-to-estimate-the-functionality-of-epn-nodes-by-accounting-for-dependency-between-epn-and-wds-networks">4-5) Implemention of an Input-Output model to estimate the functionality of EPN nodes by accounting for dependency between EPN and WDS networks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functionality-of-epn-7-and-30-days-after-event">Functionality of EPN 7 and 30 days after event</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-analysisi-of-wds-functionality-estimates-obtained-from-i-o-model">4-5-A) Analysisi of WDS Functionality Estimates obtained from I-O model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results-obtain-for-functionality-of-buildings-by-accounting-for-the-interdependency-between-buildings-and-epn-network">4-6) Results obtain for functionality of buildings by accounting for the interdependency between buildings and EPN network</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#day-after-event">1 Day After Event</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#days-after-event">7 Days After Event</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">30 Days After Event</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-buildings-having-functionality-estimates-greater-or-equal-0-5-days-after-event">Number of buildings having functionality estimates greater or equal 0.5 days after event</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="mmsa-seismic-functionality-and-restoration-analysis-for-interdependent-buildings-water-power-using-restoration-curves">
<h1>MMSA: Seismic Functionality and Restoration Analysis for Interdependent Buildings-Water-Power using Restoration Curves<a class="headerlink" href="#mmsa-seismic-functionality-and-restoration-analysis-for-interdependent-buildings-water-power-using-restoration-curves" title="Permalink to this heading">#</a></h1>
<p>The MMSA was selected as a testbed for research studies by the NIST Center for Risk-Based Community Resilience Planning to test algorithms developed for community resilience assessment on a large urban area with a diverse population and economy. The population of Memphis, Shelby County, and MMSA, respectively, are about 0.7 M, 1.0 M, and 1.4 M. This dense population lies within the most seismically active area of Central and Eastern United States, called the New Madrid Seismic Zone (NMSZ), which is capable of producing large damaging earthquakes.</p>
<p>This notebook perform seismic damage and functionality analysis of interdependent buildings, electric power and water distribution network systems of Shelby County, TN. First the geospatial infrastructure inventory and service area dataset are imported to characterize the buildings and lifeline systems of the MMSA testbed and the interdependency between infrastructure systems. Then, scenario earthquakes obtained from a ground motion prediction model to generate spatial intensity measures for the infrastructure network area and perform damage analysis to obtain component-level damage probability estimates subject to the scenario earthquake.This is followed by developing a fragility-based computational model of the networked infrastructure using graph theory where components are modeled as nodes, and the connection between nodes are modeled as directed links. The outcome of component level structural damage assessment is used to perform functionality and restoration analysis of buildings and networks by considering the interdependency between infrastructure systems and the cascading failure of each network component using an input-output model.</p>
<ul class="simple">
<li><p>This notebook was developed by Milad Roohi (CSU/UNL - milad.roohi&#64;unl.edu) in colaboration with Jiate Li (CSU) and John W. van de Lindt (CSU), the NCSA team (Jong Sung Lee, Chris Navarro, Diego Calderon, Chen Wang, Michal Ondrejcek, Gowtham Naraharisetty).</p></li>
</ul>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<p>[1] Atkinson GM, Boore DM. (1995) Ground-motion relations for eastern North America. Bulletin of the Seismological Society of America. 1995 Feb 1;85(1):17-30.</p>
<p>[2] Elnashai, A.S., Cleveland, L.J., Jefferson, T., and Harrald, J., (2008). “Impact of Earthquakes on the Central USA” A Report of the Mid-America Earthquake Center. http://mae.cee.illinois.edu/publications/publications_reports.html</p>
<p>[3] Linger S, Wolinsky M. (2001) Los Alamos National Laboratory Report LA-UR-01-3361 ESRI Paper No. 889 Estimating Electrical Service Areas Using GIS and Cellular Automata.</p>
<p>[4] Roohi M, van de Lindt JW, Rosenheim N, Hu Y, Cutler H. (2021) Implication of building inventory accuracy on physical and socio-economic resilience metrics for informed decision-making in natural hazards. Structure and Infrastructure Engineering. 2020 Nov 20;17(4):534-54.</p>
<p>[5] Federal Emergency Management Agency (FEMA). (2020) Hazus Earthquake Model Technical Manual. 2020 Oct.</p>
<p>[6] Haimes YY, Horowitz BM, Lambert JH, Santos JR, Lian C, Crowther KG. (2005) Inoperability input-output model for interdependent infrastructure sectors. I: Theory and methodology. Journal of Infrastructure Systems. 2005 Jun;11(2):67-79.</p>
<p>[7] Milad Roohi, Jiate Li, John van de Lindt. (2022) Seismic Functionality Analysis of Interdependent Buildings and Lifeline Systems 12th National Conference on Earthquake Engineering (12NCEE), Salt Lake City, UT (June 27-July 1, 2022).</p>
</section>
</section>
<section id="prerequisites">
<h1>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyincore</span> <span class="kn">import</span> <span class="n">HazardService</span><span class="p">,</span> <span class="n">IncoreClient</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">FragilityService</span><span class="p">,</span> <span class="n">MappingSet</span><span class="p">,</span> <span class="n">DataService</span><span class="p">,</span> <span class="n">SpaceService</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.buildingdamage</span> <span class="kn">import</span> <span class="n">BuildingDamage</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.pipelinedamagerepairrate</span> <span class="kn">import</span> <span class="n">PipelineDamageRepairRate</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.waterfacilitydamage</span> <span class="kn">import</span> <span class="n">WaterFacilityDamage</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.epfdamage</span> <span class="kn">import</span> <span class="n">EpfDamage</span>
<span class="kn">from</span> <span class="nn">pyincore_viz.geoutil</span> <span class="kn">import</span> <span class="n">GeoUtil</span> <span class="k">as</span> <span class="n">viz</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.montecarlofailureprobability</span> <span class="kn">import</span> <span class="n">MonteCarloFailureProbability</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">cx</span>

<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">poisson</span><span class="p">,</span><span class="n">bernoulli</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">IncoreClient</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Enter username: cnavarro
Enter password: ········
Connection successful to IN-CORE services. pyIncore version detected: 1.6.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-earthquake-hazard-scenarios">
<h1>1) Define Earthquake Hazard Scenarios<a class="headerlink" href="#define-earthquake-hazard-scenarios" title="Permalink to this heading">#</a></h1>
<p>Scenario earthquakes are created using Atkinson and Boore (1995) [1] GMPE model including earthquakes with magnitudes $M_w5.9$, $M_w6.5$ and $M_w7.1$ to study the effect of seismic hazard intensity in resilience metrics. The scenario can be selected by defining selecting earthquake magnitude using “select_EQ_magnitude” parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### Define hazard type</span>
<span class="n">hazard_type</span> <span class="o">=</span> <span class="s2">&quot;earthquake&quot;</span>

<span class="c1">#### Select the earthquake scenario magnitude from the following &#39;EQ_hazard_dict&#39; dictionary keys</span>
<span class="n">select_EQ_magnitude</span> <span class="o">=</span> <span class="mf">7.1</span>

<span class="c1">#### Define hazard dictionary with three ground motion intensity levels</span>
<span class="n">EQ_hazard_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">EQ_hazard_dict</span><span class="p">[</span><span class="mf">5.9</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s2">&quot;5e3db155edc9fa00085d7c09&quot;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;M59&#39;</span><span class="p">}</span>
<span class="n">EQ_hazard_dict</span><span class="p">[</span><span class="mf">6.5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s2">&quot;5e45a1308591b700088c799c&quot;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;M65&#39;</span><span class="p">}</span>
<span class="n">EQ_hazard_dict</span><span class="p">[</span><span class="mf">7.1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s2">&quot;5e3dd04f7fdf7e0008032bfe&quot;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;M71&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### Define filename and create folder for saving results</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="n">EQ_hazard_dict</span><span class="p">[</span><span class="n">select_EQ_magnitude</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
<span class="n">hazard_name</span> <span class="o">=</span> <span class="n">EQ_hazard_dict</span><span class="p">[</span><span class="n">select_EQ_magnitude</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="n">current_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

<span class="c1">#### create folder &quot;MMSA_analysis_results&quot; to save results</span>
<span class="n">results_folder</span> <span class="o">=</span> <span class="s2">&quot;MMSA_analysis_results&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">results_folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_folder</span><span class="p">)</span>

<span class="c1">#### define folder path for each eathquake magnitude to save results in different folders</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">current_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">results_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">hazard_name</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-infrastructure-inventory-data">
<h1>2) Define Infrastructure Inventory Data<a class="headerlink" href="#define-infrastructure-inventory-data" title="Permalink to this heading">#</a></h1>
<section id="building-inventory-data">
<h2>2-1) Building Inventory Data<a class="headerlink" href="#building-inventory-data" title="Permalink to this heading">#</a></h2>
<p>The Mid-America Earthquake (MAE) center [2] initiated the Memphis testbed (MTB) project to demonstrate the seismic risk assessment to the civil infrastructure system in Shelby County, TN. As part of that project, a high-resolution model of the physical and social infrastructure was developed to investigate the potential impact due to earthquake activity in the New Madrid Seismic Zone (NMSZ) (Elnashai et al., 2008).</p>
<p>The building inventory is defined based on the Shelby county shapefile available on the IN-CORE data service (ID: 5a284f0bc7d30d13bc081a46). This study considers all the buildings with a total number of 306003.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### Building inventory dataset for Shelby county, TN</span>
<span class="n">bldg_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;5a284f0bc7d30d13bc081a46&quot;</span>  

<span class="c1"># #### Import building dataset from IN-CORE data service</span>
<span class="n">bldg_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">bldg_dataset_id</span><span class="p">,</span> <span class="n">DataService</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>

<span class="c1"># #### Convert building dataset to geodataframe</span>
<span class="n">bldg_gdf</span> <span class="o">=</span> <span class="n">bldg_dataset</span><span class="o">.</span><span class="n">get_dataframe_from_shapefile</span><span class="p">()</span>
<span class="n">bldg_gdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>parid</th>
      <th>parid_card</th>
      <th>bldg_id</th>
      <th>struct_typ</th>
      <th>str_prob</th>
      <th>year_built</th>
      <th>no_stories</th>
      <th>a_stories</th>
      <th>b_stories</th>
      <th>bsmt_type</th>
      <th>...</th>
      <th>dgn_lvl</th>
      <th>cont_val</th>
      <th>efacility</th>
      <th>dwell_unit</th>
      <th>str_typ2</th>
      <th>occ_typ2</th>
      <th>tract_id</th>
      <th>guid</th>
      <th>IMPUTED</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>038035  00019</td>
      <td>038035  00019_1</td>
      <td>038035  00019_1_1</td>
      <td>URM</td>
      <td>0.02633</td>
      <td>1920</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>CRAWL=0-24%</td>
      <td>...</td>
      <td>Pre - Code</td>
      <td>46707</td>
      <td>FALSE</td>
      <td>1</td>
      <td>URML</td>
      <td>RES1</td>
      <td>47157001300</td>
      <td>64124791-1502-48ea-81b6-1992855f45d5</td>
      <td>F</td>
      <td>POINT (-89.94883 35.15122)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>038034  00040</td>
      <td>038034  00040_1</td>
      <td>038034  00040_1_1</td>
      <td>W1</td>
      <td>0.97366</td>
      <td>1947</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>CRAWL=0-24%</td>
      <td>...</td>
      <td>Low - Code</td>
      <td>39656</td>
      <td>FALSE</td>
      <td>1</td>
      <td>W1</td>
      <td>RES1</td>
      <td>47157001300</td>
      <td>d04da316-7cba-4964-8104-f0edfde18239</td>
      <td>F</td>
      <td>POINT (-89.95095 35.15284)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>038028  00023</td>
      <td>038028  00023_1</td>
      <td>038028  00023_1_1</td>
      <td>W1</td>
      <td>0.97366</td>
      <td>1900</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>CRAWL=0-24%</td>
      <td>...</td>
      <td>Low - Code</td>
      <td>37765</td>
      <td>FALSE</td>
      <td>1</td>
      <td>W1</td>
      <td>RES1</td>
      <td>47157001300</td>
      <td>c24d708d-a21b-416f-8772-965548407231</td>
      <td>F</td>
      <td>POINT (-89.95022 35.15976)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>034011  00008</td>
      <td>034011  00008_1</td>
      <td>034011  00008_1_1</td>
      <td>W1</td>
      <td>0.97366</td>
      <td>1926</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>CRAWL=0-24%</td>
      <td>...</td>
      <td>Low - Code</td>
      <td>59930</td>
      <td>FALSE</td>
      <td>1</td>
      <td>W1</td>
      <td>RES1</td>
      <td>47157005700</td>
      <td>6ff63801-3bf4-4bf3-b6e5-ff9d5fe6f0d0</td>
      <td>F</td>
      <td>POINT (-90.04844 35.10446)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>034011  00007</td>
      <td>034011  00007_1</td>
      <td>034011  00007_1_1</td>
      <td>W1</td>
      <td>0.97366</td>
      <td>1926</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>CRAWL=0-24%</td>
      <td>...</td>
      <td>Low - Code</td>
      <td>65276</td>
      <td>FALSE</td>
      <td>1</td>
      <td>W1</td>
      <td>RES1</td>
      <td>47157005700</td>
      <td>ef25f515-4109-408f-a3d4-3b79da49edd0</td>
      <td>F</td>
      <td>POINT (-90.04843 35.10459)</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 31 columns</p>
</div></div></div>
</div>
<section id="structural-system-type-statistics-of-mmsa-building-inventory">
<h3>Structural system type statistics of MMSA building inventory<a class="headerlink" href="#structural-system-type-statistics-of-mmsa-building-inventory" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pivot</span><span class="o">=</span> <span class="n">bldg_gdf</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
     <span class="n">index</span><span class="o">=</span><span class="s1">&#39;struct_typ&#39;</span><span class="p">,</span>
     <span class="n">values</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span>
     <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span>
<span class="p">)</span>
<span class="n">pivot</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Count&#39;</span><span class="p">]</span>
<span class="n">pivot</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Count</th>
    </tr>
    <tr>
      <th>struct_typ</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>W1</th>
      <td>271853</td>
    </tr>
    <tr>
      <th>W2</th>
      <td>12097</td>
    </tr>
    <tr>
      <th>URM</th>
      <td>11141</td>
    </tr>
    <tr>
      <th>S1</th>
      <td>3608</td>
    </tr>
    <tr>
      <th>S3</th>
      <td>3522</td>
    </tr>
    <tr>
      <th>RM</th>
      <td>1600</td>
    </tr>
    <tr>
      <th>PC1</th>
      <td>1110</td>
    </tr>
    <tr>
      <th>C1</th>
      <td>913</td>
    </tr>
    <tr>
      <th>C2</th>
      <td>81</td>
    </tr>
    <tr>
      <th>MH</th>
      <td>43</td>
    </tr>
    <tr>
      <th>PC2</th>
      <td>35</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="electric-power-network-epn-inventory-data">
<h2>2-2) Electric Power Network (EPN) Inventory Data<a class="headerlink" href="#electric-power-network-epn-inventory-data" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Read EPN node and link inventory data</span>
<span class="n">df_EPNnodes</span>  <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;shapefiles/Mem_power_link5_node.shp&quot;</span><span class="p">)</span>
<span class="n">df_EPNlinks</span>  <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;shapefiles/Mem_power_link5.shp&quot;</span><span class="p">)</span>

<span class="c1">### Plot EPN shapefiles</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df_EPNnodes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>
<span class="n">df_EPNlinks</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">df_EPNnodes</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/437ccccac92d5ddd3e19bc109652807192fb7b83f2f88f2b1801a20da9752a8c.png" src="../../_images/437ccccac92d5ddd3e19bc109652807192fb7b83f2f88f2b1801a20da9752a8c.png" />
</div>
</div>
</section>
<section id="water-distribution-system-wds-inventory-data">
<h2>2-3) Water Distribution System (WDS) Inventory Data<a class="headerlink" href="#water-distribution-system-wds-inventory-data" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Read WDS node and link inventory data</span>
<span class="n">df_WDSnodes</span>  <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;shapefiles/Mem_water_node5.shp&quot;</span><span class="p">)</span>
<span class="n">df_WDSlinks</span>  <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;shapefiles/Mem_water_pipeline_node_Modified.shp&quot;</span><span class="p">)</span>

<span class="c1">### Plot WDS shapefiles</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df_WDSnodes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>
<span class="n">df_WDSlinks</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">df_WDSnodes</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f1f00debd8a07facacc98ec0336eb5abded7d8443a47c50809be587d7a67c1bd.png" src="../../_images/f1f00debd8a07facacc98ec0336eb5abded7d8443a47c50809be587d7a67c1bd.png" />
</div>
</div>
</section>
<section id="epn-service-area-dataset">
<h2>2-4) EPN service area dataset<a class="headerlink" href="#epn-service-area-dataset" title="Permalink to this heading">#</a></h2>
<p>The interdependency between buildings and utility network infrastructure is modeled by using a Cellular Automata algorithm [3] to estimate the service areas of each network component and perform geospatial analysis to identify the buildings located within the service area of each component. A CSV file (“Memphis_EPN_Bldg_Depend.csv”) has been developd that maps each of the EPN substations to corresponsing buildings within the node’s service area.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Load the service are mapping between EPN nodes (i.e., sguid) and buildings (i.e., guid)</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="s1">&#39;Inputs/Memphis_EPN_Bldg_Depend.csv&#39;</span>
<span class="n">df_EPN_Bldg_Depend</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df_EPN_Bldg_Depend</span> <span class="o">=</span> <span class="n">df_EPN_Bldg_Depend</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Bldg_guid&#39;</span><span class="p">:</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="s1">&#39;Substation_guid&#39;</span><span class="p">:</span><span class="s1">&#39;sguid&#39;</span><span class="p">})</span>
<span class="n">df_EPN_Bldg_Depend</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>guid</th>
      <th>sguid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>4014e650-a282-47a0-8b05-be64f92541fe</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>c57a33ff-9cf9-45ec-9c2e-86bba4d585a1</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>398ef608-bcf8-4a15-bfc8-01273c9c36c2</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>0d96300b-0301-41c2-b19c-85a3c8f4c142</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>25e640e5-f6ae-4b6d-a777-4dfcbb818961</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="infrastructure-damage-analysis">
<h1>3) Infrastructure Damage Analysis<a class="headerlink" href="#infrastructure-damage-analysis" title="Permalink to this heading">#</a></h1>
<section id="buildings-physical-damage-mc-and-functionality-analysis">
<h2>3-1) Buildings Physical Damage, MC and Functionality Analysis<a class="headerlink" href="#buildings-physical-damage-mc-and-functionality-analysis" title="Permalink to this heading">#</a></h2>
<p>The “BuildingDamage” module of pyincore is used for building damage analysis. This module requires specifying the building inventory data cases and fragility mapping set, scenario hazard tye ad ID and subsequently run analysis to estimate probability of exceeding various damage states.</p>
<p>The fragility mappings are performed based on the value of five attributes, including the number of stories (“no_stories”), the occupancy type (“occ_type”), the year built (“year_built”), the structural type (“struct_typ”), and “efacility”. Once the rules in the mapping file (ID=5b47b2d9337d4a36187c7564) are satisfied, mapping IDs from the fragility service are returned to map fragility parameters to each node of the model.</p>
<section id="a-damage-analysis">
<h3>3-1-A) Damage Analysis<a class="headerlink" href="#a-damage-analysis" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### Import building damage analyis module from pyincore.</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.buildingdamage</span> <span class="kn">import</span> <span class="n">BuildingDamage</span>  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bldg_dmg</span> <span class="o">=</span> <span class="n">BuildingDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1">#### Load building input dataset</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;buildings&quot;</span><span class="p">,</span> <span class="n">bldg_dataset_id</span><span class="p">)</span> 

<span class="c1">#### Load fragility mapping</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5b47b2d9337d4a36187c7564&quot;</span>

<span class="n">bldg_mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">bldg_mapping_set</span><span class="p">)</span>

<span class="c1">#### Set analysis parameters</span>
<span class="n">result_name</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">+</span> <span class="s2">&quot;1_MMSA_building_damage_result&quot;</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="n">hazard_type</span><span class="p">)</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### Run building damage analysis</span>
<span class="n">bldg_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### Obtain the building damage results</span>
<span class="n">building_dmg_result</span> <span class="o">=</span> <span class="n">bldg_dmg</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;ds_result&#39;</span><span class="p">)</span>

<span class="c1">#### Convert the building damage results to dataframe</span>
<span class="n">df_bldg_dmg</span> <span class="o">=</span> <span class="n">building_dmg_result</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>

<span class="c1">### Remove empty rows and produce a modified dataset</span>
<span class="n">df_bldg_dmg</span> <span class="o">=</span> <span class="n">df_bldg_dmg</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">df_bldg_dmg_mod</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">df_bldg_dmg</span><span class="p">,</span>
                                        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;df_bldg_dmg_mod&quot;</span><span class="p">,</span>
                                        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;ergo:buildingDamageVer6&quot;</span><span class="p">)</span>

<span class="n">df_bldg_dmg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>LS_0</th>
      <th>LS_1</th>
      <th>LS_2</th>
      <th>DS_0</th>
      <th>DS_1</th>
      <th>DS_2</th>
      <th>DS_3</th>
      <th>haz_expose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>64124791-1502-48ea-81b6-1992855f45d5</td>
      <td>0.676206</td>
      <td>0.379284</td>
      <td>0.151218</td>
      <td>0.323794</td>
      <td>0.296922</td>
      <td>0.228066</td>
      <td>0.151218</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>d04da316-7cba-4964-8104-f0edfde18239</td>
      <td>0.503800</td>
      <td>0.147892</td>
      <td>0.028780</td>
      <td>0.496200</td>
      <td>0.355908</td>
      <td>0.119112</td>
      <td>0.028780</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>2</th>
      <td>c24d708d-a21b-416f-8772-965548407231</td>
      <td>0.507630</td>
      <td>0.150081</td>
      <td>0.029411</td>
      <td>0.492370</td>
      <td>0.357549</td>
      <td>0.120670</td>
      <td>0.029411</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6ff63801-3bf4-4bf3-b6e5-ff9d5fe6f0d0</td>
      <td>0.471768</td>
      <td>0.130416</td>
      <td>0.023927</td>
      <td>0.528232</td>
      <td>0.341353</td>
      <td>0.106489</td>
      <td>0.023927</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ef25f515-4109-408f-a3d4-3b79da49edd0</td>
      <td>0.471845</td>
      <td>0.130456</td>
      <td>0.023938</td>
      <td>0.528155</td>
      <td>0.341389</td>
      <td>0.106518</td>
      <td>0.023938</td>
      <td>yes</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="note-the-building-damage-analysis-results-subject-to-mw7-1-is-imported-from-a-csv-file-but-for-the-final-release-the-previous-code-cells-can-be-uncommented-and-use-for-damage-analysis">
<h2>Note: The building damage analysis results subject to Mw7.1 is imported from a CSV file but for the final release the previous code cells can be uncommented and use for damage analysis<a class="headerlink" href="#note-the-building-damage-analysis-results-subject-to-mw7-1-is-imported-from-a-csv-file-but-for-the-final-release-the-previous-code-cells-can-be-uncommented-and-use-for-damage-analysis" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO: junctions are not mapped hence empty; which causes problem in MC simulation later</span>
<span class="c1"># building_dmg_result = Dataset.from_file(fp+&quot;1_MMSA_building_damage_result.csv&quot;, data_type=&quot;ergo:buildingDamageVer4&quot;)</span>
<span class="c1"># df_bldg_dmg = building_dmg_result.get_dataframe_from_csv()</span>

<span class="c1"># building_dmg_result_modified = Dataset.from_dataframe(df_bldg_dmg, name=&quot;bldg_dmg_result_modified&quot;, data_type=&quot;ergo:buildingDamageVer4&quot;)</span>
<span class="c1"># df_bldg_dmg</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Add &#39;DS_max&#39; attribute to df_bldg_dmg that provide the most probable damage state for each MMSA building</span>
<span class="n">df_bldg_dmg</span><span class="p">[</span><span class="s1">&#39;DS_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_bldg_dmg</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;DS_0&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_1&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_2&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_3&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Plot of the distribution of most probable damage state for buildings</span>
<span class="n">indexes</span> <span class="o">=</span> <span class="n">df_bldg_dmg</span><span class="p">[</span><span class="s1">&#39;DS_max&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">df_bldg_dmg</span><span class="p">[</span><span class="s1">&#39;DS_max&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="n">bars</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">indexes</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">values</span><span class="p">,)</span>

<span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;% </span><span class="si">{</span><span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span><span class="w"> </span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Damage State&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Percentage&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distribution of most probable damage state for buildings&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">frame_on</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/39f57fd037ccaafb56d4d002768c1a5cb8d4beea29c4dcbc6e041ee7a2082f7b.png" src="../../_images/39f57fd037ccaafb56d4d002768c1a5cb8d4beea29c4dcbc6e041ee7a2082f7b.png" />
</div>
</div>
<section id="b-monte-carlo-simulation">
<h3>3-1-B) Monte Carlo Simulation<a class="headerlink" href="#b-monte-carlo-simulation" title="Permalink to this heading">#</a></h3>
<p>A Monte Carlo simulation (MCS) approach is employed to estimate the failure probability for each. The MCS has been widely recognized as a powerful modeling tool in risk and reliability literature to solve mathematical problems using random samples, which allows capturing the uncertainty in the damage estimation process. The MCS begins with sampling a vector r from uniform distribution U(0,1), where the length of random vector r is the number of Monte Carlo samples given by N. The samples are compared with probabilities of all damage states corresponding to hazard intensity measures to determine the damage state of each component. Subsequently, the number of samples experiencing damage state 2 and higher is calculated and the failure probability is approximated</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyincore.analyses.montecarlofailureprobability</span> <span class="kn">import</span> <span class="n">MonteCarloFailureProbability</span> 

<span class="n">num_samples</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># Require 500 samples for convergence - Selected smaller samples for testing </span>
<span class="n">result_name</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">+</span> <span class="s2">&quot;2_MMSA_mc_failure_probability_buildings&quot;</span>

<span class="n">mc_bldg</span> <span class="o">=</span> <span class="n">MonteCarloFailureProbability</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="n">mc_bldg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span> <span class="n">df_bldg_dmg_mod</span><span class="p">)</span>
<span class="n">mc_bldg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mc_bldg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_samples&quot;</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
<span class="n">mc_bldg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;damage_interval_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_0&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">])</span>
<span class="n">mc_bldg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;failure_state_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">])</span>

<span class="n">mc_bldg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc_bldg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span> 

<span class="c1"># Obtain buildings failure probabilities</span>
<span class="n">building_failure_probability</span> <span class="o">=</span> <span class="n">mc_bldg</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;failure_probability&#39;</span><span class="p">)</span>  

<span class="n">df_bldg_fail</span> <span class="o">=</span> <span class="n">building_failure_probability</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">df_bldg_fail</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>LS_0</th>
      <th>LS_1</th>
      <th>LS_2</th>
      <th>DS_0</th>
      <th>DS_1</th>
      <th>DS_2</th>
      <th>DS_3</th>
      <th>haz_expose</th>
      <th>failure_probability</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>64124791-1502-48ea-81b6-1992855f45d5</td>
      <td>0.676206</td>
      <td>0.379284</td>
      <td>0.151218</td>
      <td>0.323794</td>
      <td>0.296922</td>
      <td>0.228066</td>
      <td>0.151218</td>
      <td>yes</td>
      <td>0.66</td>
    </tr>
    <tr>
      <th>1</th>
      <td>d04da316-7cba-4964-8104-f0edfde18239</td>
      <td>0.503800</td>
      <td>0.147892</td>
      <td>0.028780</td>
      <td>0.496200</td>
      <td>0.355908</td>
      <td>0.119112</td>
      <td>0.028780</td>
      <td>yes</td>
      <td>0.45</td>
    </tr>
    <tr>
      <th>2</th>
      <td>c24d708d-a21b-416f-8772-965548407231</td>
      <td>0.507630</td>
      <td>0.150081</td>
      <td>0.029411</td>
      <td>0.492370</td>
      <td>0.357549</td>
      <td>0.120670</td>
      <td>0.029411</td>
      <td>yes</td>
      <td>0.49</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6ff63801-3bf4-4bf3-b6e5-ff9d5fe6f0d0</td>
      <td>0.471768</td>
      <td>0.130416</td>
      <td>0.023927</td>
      <td>0.528232</td>
      <td>0.341353</td>
      <td>0.106489</td>
      <td>0.023927</td>
      <td>yes</td>
      <td>0.48</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ef25f515-4109-408f-a3d4-3b79da49edd0</td>
      <td>0.471845</td>
      <td>0.130456</td>
      <td>0.023938</td>
      <td>0.528155</td>
      <td>0.341389</td>
      <td>0.106518</td>
      <td>0.023938</td>
      <td>yes</td>
      <td>0.41</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">building_damage_mcs_samples</span> <span class="o">=</span> <span class="n">mc_bldg</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;sample_failure_state&#39;</span><span class="p">)</span>  <span class="c1"># get buildings failure states</span>

<span class="n">bdmcs</span> <span class="o">=</span> <span class="n">building_damage_mcs_samples</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">bdmcs</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>failure</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>64124791-1502-48ea-81b6-1992855f45d5</td>
      <td>0,1,0,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,0,1,0,0,...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>d04da316-7cba-4964-8104-f0edfde18239</td>
      <td>1,1,1,1,1,0,0,1,1,1,0,0,1,0,0,1,0,1,1,1,1,1,1,...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>c24d708d-a21b-416f-8772-965548407231</td>
      <td>1,0,1,1,0,0,0,1,1,1,1,0,1,0,1,0,1,0,0,1,0,1,0,...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6ff63801-3bf4-4bf3-b6e5-ff9d5fe6f0d0</td>
      <td>1,0,1,1,1,1,1,0,1,0,1,1,0,1,1,1,0,0,1,1,0,1,0,...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ef25f515-4109-408f-a3d4-3b79da49edd0</td>
      <td>1,0,1,0,1,0,1,1,0,0,0,1,0,1,1,1,0,0,1,0,1,0,1,...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="c-functionality-analysis-buildings-only">
<h3>3-1-C) Functionality Analysis (Buildings Only)<a class="headerlink" href="#c-functionality-analysis-buildings-only" title="Permalink to this heading">#</a></h3>
<p>The MC samples from previous subsection are used in this subsection to perform functionality analysis and determine the functionality state of each building. According to Almufti and Willford (2013), functionality is defined as the capacity of a component to serve its intended objectives consist of structural integrity, safety, and utilities (e.g., water and electricity). An individual building can be narrowly classified into five discrete states consist of the restricted entry (State 1), restricted use (State 2), preoccupancy (State 3), baseline functionality (State 4) and full functionality (State 5). In a broader classification, functionality states can be categorized into nonfunctional (States 1 to 3) and functional (States 4 and 5). This notebook relies on the latter broader classification approach to estimate the functionality state of each building and subsequently use functionality estimates to perfom functionality analysis by accounting for interdependency between buildings and lifeline networks (i.e., EPN and WDS)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyincore.analyses.buildingfunctionality</span> <span class="kn">import</span> <span class="n">BuildingFunctionality</span>
<span class="n">bldg_func</span> <span class="o">=</span> <span class="n">BuildingFunctionality</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># Load the datasets of MC simulations for buildings</span>
<span class="n">bldg_func</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;building_damage_mcs_samples&quot;</span><span class="p">,</span> <span class="n">building_damage_mcs_samples</span><span class="p">)</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">+</span> <span class="s2">&quot;2_MMSA_mcs_functionality_probability&quot;</span>
<span class="n">bldg_func</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Run the BuildingFunctionality module to obtain the building functionality probabilities</span>
<span class="n">bldg_func</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span> 

<span class="n">bldg_func_samples</span> <span class="o">=</span> <span class="n">bldg_func</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;functionality_samples&#39;</span><span class="p">)</span>
<span class="n">df_bldg_samples</span> <span class="o">=</span> <span class="n">bldg_func_samples</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">df_bldg_samples</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>building_guid</th>
      <th>samples</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>64124791-1502-48ea-81b6-1992855f45d5</td>
      <td>0,1,0,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,0,1,0,0,...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>d04da316-7cba-4964-8104-f0edfde18239</td>
      <td>1,1,1,1,1,0,0,1,1,1,0,0,1,0,0,1,0,1,1,1,1,1,1,...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>c24d708d-a21b-416f-8772-965548407231</td>
      <td>1,0,1,1,0,0,0,1,1,1,1,0,1,0,1,0,1,0,0,1,0,1,0,...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6ff63801-3bf4-4bf3-b6e5-ff9d5fe6f0d0</td>
      <td>1,0,1,1,1,1,1,0,1,0,1,1,0,1,1,1,0,0,1,1,0,1,0,...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ef25f515-4109-408f-a3d4-3b79da49edd0</td>
      <td>1,0,1,0,1,0,1,1,0,0,0,1,0,1,1,1,0,0,1,0,1,0,1,...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bldg_func_probability</span> <span class="o">=</span> <span class="n">bldg_func</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;functionality_probability&#39;</span><span class="p">)</span>
<span class="n">df_bldg_func</span> <span class="o">=</span> <span class="n">bldg_func_probability</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">df_bldg_func</span> <span class="o">=</span> <span class="n">df_bldg_func</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;building_guid&quot;</span><span class="p">:</span> <span class="s2">&quot;guid&quot;</span><span class="p">})</span>
<span class="n">func_prob_target</span> <span class="o">=</span> <span class="mf">0.40</span>
<span class="n">df_bldg_func</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_bldg_func</span><span class="p">[</span><span class="s1">&#39;probability&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">func_prob_target</span><span class="p">,</span> <span class="s1">&#39;functionality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Non-Functional</span>
<span class="n">df_bldg_func</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_bldg_func</span><span class="p">[</span><span class="s1">&#39;probability&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">func_prob_target</span><span class="p">,</span> <span class="s1">&#39;functionality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Functional</span>
<span class="n">df_bldg_func</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_bldg_func</span><span class="p">[</span><span class="s1">&#39;probability&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">func_prob_target</span><span class="p">,</span> <span class="s1">&#39;functionality_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Non-Functional&#39;</span> <span class="c1"># Non-Functional</span>
<span class="n">df_bldg_func</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_bldg_func</span><span class="p">[</span><span class="s1">&#39;probability&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">func_prob_target</span><span class="p">,</span> <span class="s1">&#39;functionality_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Functional&#39;</span> <span class="c1"># Functional</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_bldg_func</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>probability</th>
      <th>functionality</th>
      <th>functionality_state</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>64124791-1502-48ea-81b6-1992855f45d5</td>
      <td>0.34</td>
      <td>0.0</td>
      <td>Non-Functional</td>
    </tr>
    <tr>
      <th>1</th>
      <td>d04da316-7cba-4964-8104-f0edfde18239</td>
      <td>0.55</td>
      <td>1.0</td>
      <td>Functional</td>
    </tr>
    <tr>
      <th>2</th>
      <td>c24d708d-a21b-416f-8772-965548407231</td>
      <td>0.51</td>
      <td>1.0</td>
      <td>Functional</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6ff63801-3bf4-4bf3-b6e5-ff9d5fe6f0d0</td>
      <td>0.52</td>
      <td>1.0</td>
      <td>Functional</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ef25f515-4109-408f-a3d4-3b79da49edd0</td>
      <td>0.59</td>
      <td>1.0</td>
      <td>Functional</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Plot of the distribution of most probable damage state for buildings</span>
<span class="n">indexes</span> <span class="o">=</span> <span class="n">df_bldg_func</span><span class="p">[</span><span class="s1">&#39;functionality_state&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">df_bldg_func</span><span class="p">[</span><span class="s1">&#39;functionality_state&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="n">bars</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">indexes</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">values</span><span class="p">,)</span>

<span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;% </span><span class="si">{</span><span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span><span class="w"> </span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Damage State&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Percentage&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Functionality Percentage (Buildings only)&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">frame_on</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d086ca0bf1c4854bd07e7858f577a354ebf3b13e3a7dee8c0737cc6cb40bdf3d.png" src="../../_images/d086ca0bf1c4854bd07e7858f577a354ebf3b13e3a7dee8c0737cc6cb40bdf3d.png" />
</div>
</div>
</section>
</section>
<section id="electric-power-network-epn-analysis">
<h2>3-2) Electric Power Network (EPN) Analysis<a class="headerlink" href="#electric-power-network-epn-analysis" title="Permalink to this heading">#</a></h2>
<p>This section perform damage analysis of EPN substations based on Hazus fragility functions [5].</p>
<p>Subsequntly, restoration curves of electric substations from Hazus is used to obtain functionality percentage of each substation. The output of this analysis provides the percentage of building withing each substation service area that will suffer power outage 1 day, 3 days, 7 days, 30 days and 90 days after an event.</p>
<section id="a-epn-damage-analysis">
<h3>3-2-A) EPN Damage Analysis<a class="headerlink" href="#a-epn-damage-analysis" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyincore.analyses.epfdamage.epfdamage</span> <span class="kn">import</span> <span class="n">EpfDamage</span> <span class="c1"># Import epf damage module integrated into pyIncore.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5b47be62337d4a37b6197a3a&quot;</span> 

<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>

<span class="n">epn_sub_dmg</span> <span class="o">=</span> <span class="n">EpfDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">epn_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;shapefiles/Mem_power_link5_node.shp&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;incore:epf&quot;</span><span class="p">)</span>
<span class="n">epn_sub_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;epfs&quot;</span><span class="p">,</span> <span class="n">epn_dataset</span><span class="p">)</span>
<span class="n">epn_sub_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;dfr3_mapping_set&quot;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">+</span> <span class="s2">&quot;3_MMSA_EPN_substations_dmg_result&quot;</span>
<span class="n">epn_sub_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>
<span class="n">epn_sub_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="n">hazard_type</span><span class="p">)</span>
<span class="n">epn_sub_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">epn_sub_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="n">epn_sub_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>

<span class="n">substation_dmg_result</span> <span class="o">=</span> <span class="n">epn_sub_dmg</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">)</span>

<span class="n">df_sub_dmg</span> <span class="o">=</span> <span class="n">substation_dmg_result</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">df_sub_dmg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>LS_0</th>
      <th>LS_1</th>
      <th>LS_2</th>
      <th>LS_3</th>
      <th>DS_0</th>
      <th>DS_1</th>
      <th>DS_2</th>
      <th>DS_3</th>
      <th>DS_4</th>
      <th>haz_expose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>75941d02-93bf-4ef9-87d3-d882384f6c10</td>
      <td>0.887433</td>
      <td>0.523024</td>
      <td>0.136211</td>
      <td>0.016086</td>
      <td>0.112567</td>
      <td>0.364409</td>
      <td>0.386813</td>
      <td>0.120125</td>
      <td>0.016086</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>35909c93-4b29-4616-9cd3-989d8d604481</td>
      <td>0.875883</td>
      <td>0.499762</td>
      <td>0.123873</td>
      <td>0.014042</td>
      <td>0.124117</td>
      <td>0.376121</td>
      <td>0.375889</td>
      <td>0.109831</td>
      <td>0.014042</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ce7d3164-ffda-4ac0-a9fa-d88c927897cc</td>
      <td>0.861667</td>
      <td>0.473129</td>
      <td>0.110731</td>
      <td>0.011980</td>
      <td>0.138333</td>
      <td>0.388538</td>
      <td>0.362398</td>
      <td>0.098751</td>
      <td>0.011980</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>b2bed3e1-f16c-483a-98e8-79dfd849d187</td>
      <td>0.827201</td>
      <td>0.416021</td>
      <td>0.085761</td>
      <td>0.008394</td>
      <td>0.172799</td>
      <td>0.411180</td>
      <td>0.330260</td>
      <td>0.077368</td>
      <td>0.008394</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ab011d7c-0e34-4e5d-9734-34f7858d4b68</td>
      <td>0.825880</td>
      <td>0.414013</td>
      <td>0.084957</td>
      <td>0.008286</td>
      <td>0.174120</td>
      <td>0.411868</td>
      <td>0.329056</td>
      <td>0.076671</td>
      <td>0.008286</td>
      <td>yes</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epf_df</span> <span class="o">=</span> <span class="n">epn_dataset</span><span class="o">.</span><span class="n">get_dataframe_from_shapefile</span><span class="p">()</span>
<span class="n">df_sub_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">epf_df</span><span class="p">,</span> <span class="n">df_sub_dmg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
<span class="n">df_sub_result</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nodenwid</th>
      <th>fltytype</th>
      <th>strctype</th>
      <th>utilfcltyc</th>
      <th>flow</th>
      <th>guid</th>
      <th>geometry</th>
      <th>LS_0</th>
      <th>LS_1</th>
      <th>LS_2</th>
      <th>LS_3</th>
      <th>DS_0</th>
      <th>DS_1</th>
      <th>DS_2</th>
      <th>DS_3</th>
      <th>DS_4</th>
      <th>haz_expose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>59</td>
      <td>2</td>
      <td>0</td>
      <td>ESSL</td>
      <td>0.0</td>
      <td>75941d02-93bf-4ef9-87d3-d882384f6c10</td>
      <td>POINT (-89.83611 35.28708)</td>
      <td>0.887433</td>
      <td>0.523024</td>
      <td>0.136211</td>
      <td>0.016086</td>
      <td>0.112567</td>
      <td>0.364409</td>
      <td>0.386813</td>
      <td>0.120125</td>
      <td>0.016086</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>58</td>
      <td>2</td>
      <td>0</td>
      <td>ESSL</td>
      <td>0.0</td>
      <td>35909c93-4b29-4616-9cd3-989d8d604481</td>
      <td>POINT (-89.84449 35.26734)</td>
      <td>0.875883</td>
      <td>0.499762</td>
      <td>0.123873</td>
      <td>0.014042</td>
      <td>0.124117</td>
      <td>0.376121</td>
      <td>0.375889</td>
      <td>0.109831</td>
      <td>0.014042</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>2</th>
      <td>57</td>
      <td>2</td>
      <td>0</td>
      <td>ESSL</td>
      <td>0.0</td>
      <td>ce7d3164-ffda-4ac0-a9fa-d88c927897cc</td>
      <td>POINT (-89.98442 35.24436)</td>
      <td>0.861667</td>
      <td>0.473129</td>
      <td>0.110731</td>
      <td>0.011980</td>
      <td>0.138333</td>
      <td>0.388538</td>
      <td>0.362398</td>
      <td>0.098751</td>
      <td>0.011980</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>56</td>
      <td>2</td>
      <td>0</td>
      <td>ESSL</td>
      <td>0.0</td>
      <td>b2bed3e1-f16c-483a-98e8-79dfd849d187</td>
      <td>POINT (-89.95621 35.19269)</td>
      <td>0.827201</td>
      <td>0.416021</td>
      <td>0.085761</td>
      <td>0.008394</td>
      <td>0.172799</td>
      <td>0.411180</td>
      <td>0.330260</td>
      <td>0.077368</td>
      <td>0.008394</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>4</th>
      <td>55</td>
      <td>2</td>
      <td>0</td>
      <td>ESSL</td>
      <td>0.0</td>
      <td>ab011d7c-0e34-4e5d-9734-34f7858d4b68</td>
      <td>POINT (-89.97992 35.19191)</td>
      <td>0.825880</td>
      <td>0.414013</td>
      <td>0.084957</td>
      <td>0.008286</td>
      <td>0.174120</td>
      <td>0.411868</td>
      <td>0.329056</td>
      <td>0.076671</td>
      <td>0.008286</td>
      <td>yes</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grouped_epf_dmg</span> <span class="o">=</span> <span class="n">df_sub_result</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>\
<span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;DS_0&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_1&#39;</span><span class="p">:</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_2&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_3&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_4&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;guid&#39;</span><span class="p">:</span> <span class="s1">&#39;count&#39;</span><span class="p">})</span>
<span class="n">grouped_epf_dmg</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;guid&#39;</span><span class="p">:</span> <span class="s1">&#39;total_count&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">grouped_epf_dmg</span><span class="p">[[</span><span class="s2">&quot;DS_0&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_4&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Stacked Bar Chart of Damage State Grouped by Structure Type&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;complete damage value&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">grouped_epf_dmg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DS_0</th>
      <th>DS_1</th>
      <th>DS_2</th>
      <th>DS_3</th>
      <th>DS_4</th>
      <th>total_count</th>
    </tr>
    <tr>
      <th>utilfcltyc</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>EPPL</th>
      <td>0.205238</td>
      <td>0.408037</td>
      <td>0.304595</td>
      <td>0.073325</td>
      <td>0.008805</td>
      <td>9</td>
    </tr>
    <tr>
      <th>ESSH</th>
      <td>0.216524</td>
      <td>0.417698</td>
      <td>0.294702</td>
      <td>0.064186</td>
      <td>0.006890</td>
      <td>36</td>
    </tr>
    <tr>
      <th>ESSL</th>
      <td>0.224217</td>
      <td>0.417787</td>
      <td>0.289044</td>
      <td>0.062292</td>
      <td>0.006660</td>
      <td>14</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="../../_images/dcd30c73f3fa87b5bae6a10332aa367a5d4b5314958168610bfa0c372c69b363.png" src="../../_images/dcd30c73f3fa87b5bae6a10332aa367a5d4b5314958168610bfa0c372c69b363.png" />
</div>
</div>
</section>
<section id="b-epn-monte-carlo-analysis">
<h3>3-2-B) EPN Monte Carlo Analysis<a class="headerlink" href="#b-epn-monte-carlo-analysis" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyincore.analyses.montecarlofailureprobability</span> <span class="kn">import</span> <span class="n">MonteCarloFailureProbability</span>

<span class="n">num_samples</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">mc_sub</span> <span class="o">=</span> <span class="n">MonteCarloFailureProbability</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="n">result_name</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">+</span> <span class="s2">&quot;3_MMSA_EPN_substations_mc_failure_probability&quot;</span>
<span class="n">mc_sub</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span> <span class="n">substation_dmg_result</span><span class="p">)</span>
<span class="n">mc_sub</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">mc_sub</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_samples&quot;</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
<span class="n">mc_sub</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;damage_interval_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_0&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_4&quot;</span><span class="p">])</span>
<span class="n">mc_sub</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;failure_state_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_3&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_4&quot;</span><span class="p">])</span>

<span class="n">mc_sub</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span> <span class="c1"># name of csv file with results</span>
<span class="n">mc_sub</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">substation_failure_probability</span> <span class="o">=</span> <span class="n">mc_sub</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;failure_probability&#39;</span><span class="p">)</span>  <span class="c1"># get buildings failure probabilities</span>

<span class="n">df_substation_fail</span> <span class="o">=</span> <span class="n">substation_failure_probability</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">df_substation_fail</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>LS_0</th>
      <th>LS_1</th>
      <th>LS_2</th>
      <th>LS_3</th>
      <th>DS_0</th>
      <th>DS_1</th>
      <th>DS_2</th>
      <th>DS_3</th>
      <th>DS_4</th>
      <th>haz_expose</th>
      <th>failure_probability</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>75941d02-93bf-4ef9-87d3-d882384f6c10</td>
      <td>0.887433</td>
      <td>0.523024</td>
      <td>0.136211</td>
      <td>0.016086</td>
      <td>0.112567</td>
      <td>0.364409</td>
      <td>0.386813</td>
      <td>0.120125</td>
      <td>0.016086</td>
      <td>yes</td>
      <td>0.1345</td>
    </tr>
    <tr>
      <th>1</th>
      <td>35909c93-4b29-4616-9cd3-989d8d604481</td>
      <td>0.875883</td>
      <td>0.499762</td>
      <td>0.123873</td>
      <td>0.014042</td>
      <td>0.124117</td>
      <td>0.376121</td>
      <td>0.375889</td>
      <td>0.109831</td>
      <td>0.014042</td>
      <td>yes</td>
      <td>0.1217</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ce7d3164-ffda-4ac0-a9fa-d88c927897cc</td>
      <td>0.861667</td>
      <td>0.473129</td>
      <td>0.110731</td>
      <td>0.011980</td>
      <td>0.138333</td>
      <td>0.388538</td>
      <td>0.362398</td>
      <td>0.098751</td>
      <td>0.011980</td>
      <td>yes</td>
      <td>0.1114</td>
    </tr>
    <tr>
      <th>3</th>
      <td>b2bed3e1-f16c-483a-98e8-79dfd849d187</td>
      <td>0.827201</td>
      <td>0.416021</td>
      <td>0.085761</td>
      <td>0.008394</td>
      <td>0.172799</td>
      <td>0.411180</td>
      <td>0.330260</td>
      <td>0.077368</td>
      <td>0.008394</td>
      <td>yes</td>
      <td>0.0856</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ab011d7c-0e34-4e5d-9734-34f7858d4b68</td>
      <td>0.825880</td>
      <td>0.414013</td>
      <td>0.084957</td>
      <td>0.008286</td>
      <td>0.174120</td>
      <td>0.411868</td>
      <td>0.329056</td>
      <td>0.076671</td>
      <td>0.008286</td>
      <td>yes</td>
      <td>0.0878</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">substation_damage_mcs_samples</span> <span class="o">=</span> <span class="n">mc_sub</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;sample_failure_state&#39;</span><span class="p">)</span>

<span class="n">sdmcs</span> <span class="o">=</span> <span class="n">substation_damage_mcs_samples</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">sdmcs</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>failure</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>75941d02-93bf-4ef9-87d3-d882384f6c10</td>
      <td>1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>35909c93-4b29-4616-9cd3-989d8d604481</td>
      <td>1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,0,...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ce7d3164-ffda-4ac0-a9fa-d88c927897cc</td>
      <td>1,1,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>b2bed3e1-f16c-483a-98e8-79dfd849d187</td>
      <td>1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ab011d7c-0e34-4e5d-9734-34f7858d4b68</td>
      <td>1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="water-distribution-system-analysis">
<h3>3-3) Water Distribution System Analysis<a class="headerlink" href="#water-distribution-system-analysis" title="Permalink to this heading">#</a></h3>
<p>This section perform damage analysis of WDS including water facility and pipelines.</p>
<section id="a-water-facility-wf-damage-analysis">
<h4>3-3-A) Water Facility (WF) Damage Analysis<a class="headerlink" href="#a-water-facility-wf-damage-analysis" title="Permalink to this heading">#</a></h4>
<p>Hazus fragility functions used to analyze the water facilities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Water facility inventory for Shelby County, TN</span>
<span class="n">facility_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;5a284f2ac7d30d13bc081e52&quot;</span> <span class="c1"># Mem_water_node5.dbf = 2 node types</span>

<span class="c1"># Default water facility fragility mapping</span>
<span class="c1">#mapping_id = &quot;5b47c3b1337d4a387e85564b&quot;  # Hazus Potable Water Facility Fragility Mapping - Only PGA</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5b47c383337d4a387669d592&quot;</span> <span class="c1">#Potable Water Facility Fragility Mapping for INA - Has PGD</span>
<span class="n">fragility_key</span> <span class="o">=</span> <span class="s2">&quot;pga&quot;</span>

<span class="c1"># Liquefaction parameters</span>
<span class="n">liq_geology_dataset_id</span> <span class="o">=</span>  <span class="s2">&quot;5a284f53c7d30d13bc08249c&quot;</span>
<span class="n">liquefaction</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">liq_fragility_key</span> <span class="o">=</span> <span class="s2">&quot;pgd&quot;</span>

<span class="c1"># Hazard uncertainty</span>
<span class="n">uncertainty</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">facility_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">facility_dataset_id</span><span class="p">,</span> <span class="n">DataService</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>
<span class="n">df_inv_facility</span> <span class="o">=</span> <span class="n">facility_dataset</span><span class="o">.</span><span class="n">get_dataframe_from_shapefile</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df_inv_facility</span><span class="o">.</span><span class="n">utilfcltyc</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
[&#39;PSTAS&#39; &#39;PPPL&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_inv_facility</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nodenwid</th>
      <th>fltytype</th>
      <th>strctype</th>
      <th>utilfcltyc</th>
      <th>backuppowe</th>
      <th>flow</th>
      <th>guid</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>49</td>
      <td>1</td>
      <td>0</td>
      <td>PSTAS</td>
      <td>0</td>
      <td>-2.0</td>
      <td>a007a9b0-c2ec-4bdc-beec-8c92e3b515dd</td>
      <td>POINT (-89.67220 35.38030)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>48</td>
      <td>1</td>
      <td>0</td>
      <td>PSTAS</td>
      <td>0</td>
      <td>-1.0</td>
      <td>5a968e23-b0d3-4677-abd1-5767f3cad8ee</td>
      <td>POINT (-89.91048 35.38670)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>47</td>
      <td>1</td>
      <td>0</td>
      <td>PSTAS</td>
      <td>0</td>
      <td>-1.0</td>
      <td>22206135-813f-4455-9f42-7cff7b21688c</td>
      <td>POINT (-89.95240 35.38589)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>46</td>
      <td>1</td>
      <td>0</td>
      <td>PSTAS</td>
      <td>0</td>
      <td>-2.0</td>
      <td>e1bce78d-00a1-4605-95f3-3776ff907f73</td>
      <td>POINT (-89.91344 35.36385)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>45</td>
      <td>1</td>
      <td>0</td>
      <td>PSTAS</td>
      <td>0</td>
      <td>-1.0</td>
      <td>ddadb420-6057-49f6-8d29-3467906a1452</td>
      <td>POINT (-89.94969 35.36866)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create water facility damage analysis</span>
<span class="n">wf_dmg</span> <span class="o">=</span> <span class="n">WaterFacilityDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># Load water facility inventory dataset</span>
<span class="n">wf_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;water_facilities&quot;</span><span class="p">,</span> <span class="n">facility_dataset_id</span><span class="p">)</span>

<span class="c1"># Load fragility mapping</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">wf_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;dfr3_mapping_set&quot;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify result name</span>
<span class="n">result_name</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">+</span> <span class="s2">&quot;2_MMSA_facility_dmg_result&quot;</span>

<span class="c1"># Set analysis parameters</span>
<span class="n">wf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>
<span class="n">wf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="n">hazard_type</span><span class="p">)</span>
<span class="n">wf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">wf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;fragility_key&quot;</span><span class="p">,</span> <span class="n">fragility_key</span><span class="p">)</span>
<span class="n">wf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;use_liquefaction&quot;</span><span class="p">,</span> <span class="n">liquefaction</span><span class="p">)</span>
<span class="n">wf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;liquefaction_geology_dataset_id&quot;</span><span class="p">,</span> <span class="n">liq_geology_dataset_id</span><span class="p">)</span>
<span class="n">wf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;liquefaction_fragility_key&quot;</span><span class="p">,</span> <span class="n">liq_fragility_key</span><span class="p">)</span>
<span class="n">wf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;use_hazard_uncertainty&quot;</span><span class="p">,</span> <span class="n">uncertainty</span><span class="p">)</span>
<span class="n">wf_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run water facility damage analysis</span>
<span class="n">wf_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waterfacility_dmg_result</span> <span class="o">=</span> <span class="n">wf_dmg</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">)</span>

<span class="c1"># Convert dataset to Pandas DataFrame</span>
<span class="n">df_waterfacility_dmg</span> <span class="o">=</span> <span class="n">waterfacility_dmg_result</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">df_waterfacility_dmg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>LS_0</th>
      <th>LS_1</th>
      <th>LS_2</th>
      <th>LS_3</th>
      <th>DS_0</th>
      <th>DS_1</th>
      <th>DS_2</th>
      <th>DS_3</th>
      <th>DS_4</th>
      <th>haz_expose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a007a9b0-c2ec-4bdc-beec-8c92e3b515dd</td>
      <td>0.920681</td>
      <td>0.600414</td>
      <td>0.183840</td>
      <td>0.024956</td>
      <td>0.079319</td>
      <td>0.320266</td>
      <td>0.416574</td>
      <td>0.158884</td>
      <td>0.024956</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5a968e23-b0d3-4677-abd1-5767f3cad8ee</td>
      <td>0.940153</td>
      <td>0.655722</td>
      <td>0.225295</td>
      <td>0.033957</td>
      <td>0.059847</td>
      <td>0.284431</td>
      <td>0.430426</td>
      <td>0.191339</td>
      <td>0.033957</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>2</th>
      <td>22206135-813f-4455-9f42-7cff7b21688c</td>
      <td>0.939535</td>
      <td>0.653812</td>
      <td>0.223743</td>
      <td>0.033598</td>
      <td>0.060465</td>
      <td>0.285723</td>
      <td>0.430069</td>
      <td>0.190145</td>
      <td>0.033598</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>e1bce78d-00a1-4605-95f3-3776ff907f73</td>
      <td>0.930022</td>
      <td>0.625784</td>
      <td>0.201989</td>
      <td>0.028748</td>
      <td>0.069978</td>
      <td>0.304238</td>
      <td>0.423795</td>
      <td>0.173241</td>
      <td>0.028748</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ddadb420-6057-49f6-8d29-3467906a1452</td>
      <td>0.931985</td>
      <td>0.631374</td>
      <td>0.206179</td>
      <td>0.029656</td>
      <td>0.068015</td>
      <td>0.300611</td>
      <td>0.425195</td>
      <td>0.176524</td>
      <td>0.029656</td>
      <td>yes</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="b-water-facility-wf-mc-simulations">
<h4>3-3-B) Water Facility (WF) MC Simulations<a class="headerlink" href="#b-water-facility-wf-mc-simulations" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc_wf</span> <span class="o">=</span> <span class="n">MonteCarloFailureProbability</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">num_samples</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">mc_wf</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span> <span class="n">waterfacility_dmg_result</span><span class="p">)</span>
<span class="n">mc_wf</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="s2">&quot;wf_dmg_mc&quot;</span><span class="p">)</span>
<span class="n">mc_wf</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mc_wf</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_samples&quot;</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
<span class="n">mc_wf</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;damage_interval_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_0&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_4&quot;</span><span class="p">])</span>
<span class="n">mc_wf</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;failure_state_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_3&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_4&quot;</span><span class="p">])</span>
<span class="n">mc_wf</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get water facility failure probabilities</span>
<span class="n">waterfacility_failure_probability</span> <span class="o">=</span> <span class="n">mc_wf</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;failure_probability&#39;</span><span class="p">)</span>  
<span class="n">df_waterfacility_fail</span> <span class="o">=</span> <span class="n">waterfacility_failure_probability</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">df_waterfacility_fail</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>LS_0</th>
      <th>LS_1</th>
      <th>LS_2</th>
      <th>LS_3</th>
      <th>DS_0</th>
      <th>DS_1</th>
      <th>DS_2</th>
      <th>DS_3</th>
      <th>DS_4</th>
      <th>haz_expose</th>
      <th>failure_probability</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a007a9b0-c2ec-4bdc-beec-8c92e3b515dd</td>
      <td>0.920681</td>
      <td>0.600414</td>
      <td>0.183840</td>
      <td>0.024956</td>
      <td>0.079319</td>
      <td>0.320266</td>
      <td>0.416574</td>
      <td>0.158884</td>
      <td>0.024956</td>
      <td>yes</td>
      <td>0.1832</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5a968e23-b0d3-4677-abd1-5767f3cad8ee</td>
      <td>0.940153</td>
      <td>0.655722</td>
      <td>0.225295</td>
      <td>0.033957</td>
      <td>0.059847</td>
      <td>0.284431</td>
      <td>0.430426</td>
      <td>0.191339</td>
      <td>0.033957</td>
      <td>yes</td>
      <td>0.2252</td>
    </tr>
    <tr>
      <th>2</th>
      <td>22206135-813f-4455-9f42-7cff7b21688c</td>
      <td>0.939535</td>
      <td>0.653812</td>
      <td>0.223743</td>
      <td>0.033598</td>
      <td>0.060465</td>
      <td>0.285723</td>
      <td>0.430069</td>
      <td>0.190145</td>
      <td>0.033598</td>
      <td>yes</td>
      <td>0.2249</td>
    </tr>
    <tr>
      <th>3</th>
      <td>e1bce78d-00a1-4605-95f3-3776ff907f73</td>
      <td>0.930022</td>
      <td>0.625784</td>
      <td>0.201989</td>
      <td>0.028748</td>
      <td>0.069978</td>
      <td>0.304238</td>
      <td>0.423795</td>
      <td>0.173241</td>
      <td>0.028748</td>
      <td>yes</td>
      <td>0.2014</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ddadb420-6057-49f6-8d29-3467906a1452</td>
      <td>0.931985</td>
      <td>0.631374</td>
      <td>0.206179</td>
      <td>0.029656</td>
      <td>0.068015</td>
      <td>0.300611</td>
      <td>0.425195</td>
      <td>0.176524</td>
      <td>0.029656</td>
      <td>yes</td>
      <td>0.2043</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="c-pipeline-damage-and-servicability-analysis">
<h4>3-3-C) Pipeline Damage and Servicability Analysis<a class="headerlink" href="#c-pipeline-damage-and-servicability-analysis" title="Permalink to this heading">#</a></h4>
<p>Pipelines are analyzed using PipelineDamageRepairRate module of pyincore and subsequently the servicability index for each pipeline is estimated using Hazus procedure [5]</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Water Buried Pipeline inventory in Shelby county, TN</span>
<span class="n">pipeline_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;5a284f28c7d30d13bc081d14&quot;</span>

<span class="c1"># pipeline fragility mapping</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;5b47c227337d4a38464efea8&quot;</span>

<span class="c1"># Geology dataset</span>
<span class="n">liq_geology_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;5a284f53c7d30d13bc08249c&quot;</span>
<span class="n">liq_fragility_key</span> <span class="o">=</span> <span class="s2">&quot;pgd&quot;</span>

<span class="n">use_liq</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">use_liq</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">pipeline_dataset_id</span><span class="p">,</span> <span class="n">DataService</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>
<span class="n">df_inv_pipeline</span> <span class="o">=</span> <span class="n">pipeline_dataset</span><span class="o">.</span><span class="n">get_dataframe_from_shapefile</span><span class="p">()</span>
<span class="n">df_inv_pipeline</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_inv_pipeline</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<span class="n">df_inv_pipeline</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_inv_pipeline</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
<span class="n">df_inv_pipeline</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>linknwid</th>
      <th>fromnode</th>
      <th>tonode</th>
      <th>direction</th>
      <th>pipetype</th>
      <th>jointtype</th>
      <th>diameter</th>
      <th>length</th>
      <th>soiltype</th>
      <th>capacity</th>
      <th>guid</th>
      <th>pipelinesc</th>
      <th>pipelinehz</th>
      <th>geometry</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>70</td>
      <td>46</td>
      <td>48</td>
      <td>0</td>
      <td>Welded Steel</td>
      <td>Lap Arc Welded</td>
      <td>2.0</td>
      <td>2.55</td>
      <td>Corrosive</td>
      <td>2000.0</td>
      <td>0a076a0d-54fa-4f82-a8af-ce3bd227fcfa</td>
      <td>PWP2</td>
      <td>1</td>
      <td>LINESTRING (-89.91048 35.38670, -89.91344 35.3...</td>
      <td>-89.911958</td>
      <td>35.375274</td>
    </tr>
    <tr>
      <th>1</th>
      <td>63</td>
      <td>38</td>
      <td>41</td>
      <td>0</td>
      <td>Welded Steel</td>
      <td>Lap Arc Welded</td>
      <td>2.0</td>
      <td>2.18</td>
      <td>Corrosive</td>
      <td>2000.0</td>
      <td>cee37f5e-6e62-40e6-be5a-485d5c78bd25</td>
      <td>PWP2</td>
      <td>1</td>
      <td>LINESTRING (-89.75848 35.33466, -89.76512 35.3...</td>
      <td>-89.761802</td>
      <td>35.325240</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>2</td>
      <td>3</td>
      <td>0</td>
      <td>Welded Steel</td>
      <td>Lap Arc Welded</td>
      <td>2.0</td>
      <td>11.10</td>
      <td>Corrosive</td>
      <td>2000.0</td>
      <td>77f5d8b6-ad73-4959-b357-0c512d8f2bcd</td>
      <td>PWP2</td>
      <td>1</td>
      <td>LINESTRING (-90.11234 35.02180, -90.11320 35.0...</td>
      <td>-90.060825</td>
      <td>35.014531</td>
    </tr>
    <tr>
      <th>3</th>
      <td>33</td>
      <td>10</td>
      <td>30</td>
      <td>1</td>
      <td>Welded Steel</td>
      <td>Lap Arc Welded</td>
      <td>2.0</td>
      <td>5.26</td>
      <td>Corrosive</td>
      <td>2000.0</td>
      <td>07267d06-089e-4db7-a479-1794cdc23be3</td>
      <td>PWP2</td>
      <td>1</td>
      <td>LINESTRING (-89.76882 35.20369, -89.74608 35.1...</td>
      <td>-89.757452</td>
      <td>35.181865</td>
    </tr>
    <tr>
      <th>4</th>
      <td>59</td>
      <td>32</td>
      <td>36</td>
      <td>0</td>
      <td>Welded Steel</td>
      <td>Lap Arc Welded</td>
      <td>2.0</td>
      <td>12.20</td>
      <td>Corrosive</td>
      <td>2000.0</td>
      <td>ec3d4c41-ae4a-4489-9984-1d96e7f4ae06</td>
      <td>PWP2</td>
      <td>1</td>
      <td>LINESTRING (-89.65750 35.20729, -89.65645 35.2...</td>
      <td>-89.685531</td>
      <td>35.249394</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pipeline damage with repair rate</span>
<span class="n">pipeline_dmg_w_rr</span> <span class="o">=</span> <span class="n">PipelineDamageRepairRate</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># Load pipeline inventory as input datasets</span>
<span class="n">pipeline_dmg_w_rr</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;pipeline&quot;</span><span class="p">,</span> <span class="n">pipeline_dataset_id</span><span class="p">)</span>

<span class="c1"># Load fragility mapping</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
<span class="n">pipeline_dmg_w_rr</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;dfr3_mapping_set&quot;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify the result name</span>
<span class="n">result_name</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">+</span> <span class="s2">&quot;2_MMSA_pipeline_dmg_result&quot;</span>

<span class="c1"># Set analysis parameters</span>
<span class="n">pipeline_dmg_w_rr</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>
<span class="n">pipeline_dmg_w_rr</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="n">hazard_type</span><span class="p">)</span>
<span class="n">pipeline_dmg_w_rr</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">pipeline_dmg_w_rr</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;liquefaction_fragility_key&quot;</span><span class="p">,</span> <span class="n">liq_fragility_key</span><span class="p">)</span>
<span class="n">pipeline_dmg_w_rr</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;liquefaction_geology_dataset_id&quot;</span><span class="p">,</span><span class="n">liq_geology_dataset_id</span><span class="p">)</span>
<span class="n">pipeline_dmg_w_rr</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;use_liquefaction&quot;</span><span class="p">,</span> <span class="n">use_liq</span><span class="p">)</span>
<span class="n">pipeline_dmg_w_rr</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run pipeline  damage analysis</span>
<span class="n">pipeline_dmg_w_rr</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieve result dataset</span>
<span class="n">pipline_dmg_result</span> <span class="o">=</span> <span class="n">pipeline_dmg_w_rr</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">)</span>

<span class="c1"># Convert dataset to Pandas DataFrame</span>
<span class="n">df_pipline_dmg</span> <span class="o">=</span> <span class="n">pipline_dmg_result</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">df_pipline_dmg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>pgvrepairs</th>
      <th>pgdrepairs</th>
      <th>repairspkm</th>
      <th>breakrate</th>
      <th>leakrate</th>
      <th>failprob</th>
      <th>numpgvrpr</th>
      <th>numpgdrpr</th>
      <th>numrepairs</th>
      <th>haz_expose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0a076a0d-54fa-4f82-a8af-ce3bd227fcfa</td>
      <td>0.009045</td>
      <td>0.0</td>
      <td>0.009045</td>
      <td>0.001809</td>
      <td>0.007236</td>
      <td>0.004602</td>
      <td>0.023065</td>
      <td>0.0</td>
      <td>0.023065</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>cee37f5e-6e62-40e6-be5a-485d5c78bd25</td>
      <td>0.007119</td>
      <td>0.0</td>
      <td>0.007119</td>
      <td>0.001424</td>
      <td>0.005695</td>
      <td>0.003099</td>
      <td>0.015519</td>
      <td>0.0</td>
      <td>0.015519</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>2</th>
      <td>77f5d8b6-ad73-4959-b357-0c512d8f2bcd</td>
      <td>0.002919</td>
      <td>0.0</td>
      <td>0.002919</td>
      <td>0.000584</td>
      <td>0.002335</td>
      <td>0.006459</td>
      <td>0.032402</td>
      <td>0.0</td>
      <td>0.032402</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>07267d06-089e-4db7-a479-1794cdc23be3</td>
      <td>0.004505</td>
      <td>0.0</td>
      <td>0.004505</td>
      <td>0.000901</td>
      <td>0.003604</td>
      <td>0.004728</td>
      <td>0.023698</td>
      <td>0.0</td>
      <td>0.023698</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ec3d4c41-ae4a-4489-9984-1d96e7f4ae06</td>
      <td>0.005289</td>
      <td>0.0</td>
      <td>0.005289</td>
      <td>0.001058</td>
      <td>0.004231</td>
      <td>0.012821</td>
      <td>0.064521</td>
      <td>0.0</td>
      <td>0.064521</td>
      <td>yes</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_WDS_links</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_WDSlinks</span><span class="p">,</span> <span class="n">df_pipline_dmg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
<span class="n">df_WDSlinks</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>linknwid</th>
      <th>fromnode</th>
      <th>tonode</th>
      <th>direction</th>
      <th>pipetype</th>
      <th>jointtype</th>
      <th>diameter</th>
      <th>length</th>
      <th>soiltype</th>
      <th>capacity</th>
      <th>...</th>
      <th>repairspkm</th>
      <th>breakrate</th>
      <th>leakrate</th>
      <th>failprob</th>
      <th>numpgvrpr</th>
      <th>numpgdrpr</th>
      <th>numrepairs</th>
      <th>haz_expose</th>
      <th>PGVfailpro</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>70</td>
      <td>46</td>
      <td>48</td>
      <td>1</td>
      <td>Welded Steel</td>
      <td>Lap Arc Welded</td>
      <td>2.0</td>
      <td>2.55</td>
      <td>Corrosive</td>
      <td>2000.0</td>
      <td>...</td>
      <td>3.263349</td>
      <td>2.609711</td>
      <td>0.653638</td>
      <td>0.998712</td>
      <td>0.004114</td>
      <td>8.317425</td>
      <td>8.321540</td>
      <td>yes</td>
      <td>0.004106</td>
      <td>LINESTRING (-89.91048 35.38670, -89.91344 35.3...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>63</td>
      <td>41</td>
      <td>38</td>
      <td>0</td>
      <td>Welded Steel</td>
      <td>Lap Arc Welded</td>
      <td>2.0</td>
      <td>2.18</td>
      <td>Corrosive</td>
      <td>2000.0</td>
      <td>...</td>
      <td>1.816326</td>
      <td>1.452299</td>
      <td>0.364027</td>
      <td>0.957829</td>
      <td>0.002768</td>
      <td>3.956822</td>
      <td>3.959590</td>
      <td>yes</td>
      <td>0.002764</td>
      <td>LINESTRING (-89.75848 35.33466, -89.76512 35.3...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>Welded Steel</td>
      <td>Lap Arc Welded</td>
      <td>2.0</td>
      <td>11.10</td>
      <td>Corrosive</td>
      <td>2000.0</td>
      <td>...</td>
      <td>1.637020</td>
      <td>1.309304</td>
      <td>0.327717</td>
      <td>1.000000</td>
      <td>0.005780</td>
      <td>18.165148</td>
      <td>18.170927</td>
      <td>yes</td>
      <td>0.005763</td>
      <td>LINESTRING (-90.11234 35.02180, -90.11320 35.0...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>33</td>
      <td>10</td>
      <td>30</td>
      <td>1</td>
      <td>Welded Steel</td>
      <td>Lap Arc Welded</td>
      <td>2.0</td>
      <td>5.26</td>
      <td>Corrosive</td>
      <td>2000.0</td>
      <td>...</td>
      <td>1.637303</td>
      <td>1.309361</td>
      <td>0.327943</td>
      <td>0.998979</td>
      <td>0.004227</td>
      <td>8.607989</td>
      <td>8.612216</td>
      <td>yes</td>
      <td>0.004218</td>
      <td>LINESTRING (-89.76882 35.20369, -89.74608 35.1...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>59</td>
      <td>32</td>
      <td>36</td>
      <td>1</td>
      <td>Welded Steel</td>
      <td>Lap Arc Welded</td>
      <td>2.0</td>
      <td>12.20</td>
      <td>Corrosive</td>
      <td>2000.0</td>
      <td>...</td>
      <td>1.637443</td>
      <td>1.309388</td>
      <td>0.328055</td>
      <td>1.000000</td>
      <td>0.011509</td>
      <td>19.965297</td>
      <td>19.976806</td>
      <td>yes</td>
      <td>0.011443</td>
      <td>LINESTRING (-89.65750 35.20729, -89.65645 35.2...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 27 columns</p>
</div></div></div>
</div>
<p>For pipelines, Hazus [5] assumes two damage states consist of: leaks and breaks. When a pipe is damaged due to ground failure (PGD), the type of damage is likely to be a break, while when a pipe is damaged due to seismic wave propagation (PGV), the type of damage is likely to be joint pull-out or crushing at the bell, which generally cause leaks. In the Hazus Methodology, it is assumed that damage due to seismic waves will consist of 80% leaks and 20% breaks, while damage due to ground failure will consist of 20% leaks and 80% breaks. Servicability index can be calculated using the following equation</p>
<p>$$ SI = 1 - Lognormal(ARR, 0.1, 0.85) $$</p>
<p>Where SI is servicability index, ARR is average repair rate and the lognormal function has a median of 0.1 repairs/km and a beta of 0.85, and . Please refer to section 8.1.7 of Hazs (Water System Performance) for further information</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">df_WDSlinks</span><span class="p">[</span><span class="s1">&#39;linknwid&#39;</span><span class="p">]:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_WDSlinks</span><span class="p">[</span><span class="n">df_WDSlinks</span><span class="o">.</span><span class="n">linknwid</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">idx</span><span class="p">])]</span>

    <span class="c1"># standard deviation of normal distribution</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.85</span>
    
    <span class="c1"># mean of normal distribution</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">.1</span><span class="p">)</span>
    
    <span class="n">C_pgv</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># 0.2</span>
    <span class="n">C_pgd</span> <span class="o">=</span> <span class="mf">0.8</span> <span class="c1"># 0.8</span>
    <span class="n">im</span> <span class="o">=</span> <span class="p">(</span><span class="n">C_pgv</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;numpgvrpr&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">C_pgd</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;numpgdrpr&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">SI_break</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">stats</span><span class="o">.</span><span class="n">lognorm</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
    
    <span class="n">C_pgv</span> <span class="o">=</span> <span class="mf">0.8</span>  <span class="c1"># 0.2</span>
    <span class="n">C_pgd</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># 0.8</span>
    <span class="n">im</span> <span class="o">=</span> <span class="p">(</span><span class="n">C_pgv</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;numpgvrpr&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">C_pgd</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;numpgdrpr&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">SI_leak</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">stats</span><span class="o">.</span><span class="n">lognorm</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
    
    <span class="n">m</span> <span class="o">=</span> <span class="n">df_WDSlinks</span><span class="p">[</span><span class="s1">&#39;linknwid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">idx</span>
    <span class="n">df_WDSlinks</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;SI_break_idv&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">SI_break</span>
    <span class="n">df_WDSlinks</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;SI_leak__idv&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">SI_leak</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="restoration-and-functionality-analysis">
<h1>4) Restoration and Functionality Analysis<a class="headerlink" href="#restoration-and-functionality-analysis" title="Permalink to this heading">#</a></h1>
<section id="networkx-modeling-of-epn-and-wds-networks">
<h2>4-1) NetworkX Modeling of EPN and WDS networks<a class="headerlink" href="#networkx-modeling-of-epn-and-wds-networks" title="Permalink to this heading">#</a></h2>
<p>To perform restoration and functionality analysis of infrastruture, first a directed graph model of the EPN and WDS, given by G_EPN and G_WDS, is developed. Subsequently, these two networkX graphs are combined to obtain an interdependednt graph of two networks given by G_EPN_WDS; this graph can be represented by an $n×n$ adjacency matrix $M(G)=[m_{ij}]$. [7]</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### shp_to_network functions takes node and edge shapefiles of an infrastruture network</span>
<span class="c1">### and constructs a networkX graph give by G</span>

<span class="k">def</span> <span class="nf">shp_to_network</span><span class="p">(</span><span class="n">df_network_nodes</span><span class="p">,</span> <span class="n">df_network_links</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="s1">&#39;unsorted&#39;</span><span class="p">):</span>
    
    <span class="n">G</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span> <span class="c1">#Empty graph</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">df_network_nodes</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">df_network_nodes</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">df_network_nodes</span><span class="p">[</span><span class="s1">&#39;nodenwid&#39;</span><span class="p">]</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df_network_nodes</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">df_network_nodes</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_network_nodes</span><span class="p">[</span><span class="s2">&quot;nodenwid&quot;</span><span class="p">]):</span>
        <span class="n">pos</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_network_links</span><span class="p">[</span><span class="s2">&quot;fromnode&quot;</span><span class="p">],</span><span class="n">df_network_links</span><span class="p">[</span><span class="s2">&quot;tonode&quot;</span><span class="p">])]</span>
    <span class="n">edge</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">sort</span> <span class="o">==</span> <span class="s1">&#39;sorted&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_network_links</span><span class="p">[</span><span class="s2">&quot;linknwid&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">df_network_links</span><span class="p">[</span><span class="s2">&quot;direction&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">edge</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">df_network_links</span><span class="p">[</span><span class="s2">&quot;fromnode&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">df_network_links</span><span class="p">[</span><span class="s2">&quot;tonode&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">edge</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">df_network_links</span><span class="p">[</span><span class="s2">&quot;tonode&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">df_network_links</span><span class="p">[</span><span class="s2">&quot;fromnode&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">sort</span> <span class="o">==</span> <span class="s1">&#39;unsorted&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_network_links</span><span class="p">[</span><span class="s2">&quot;linknwid&quot;</span><span class="p">]):</span>
            <span class="n">edge</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">df_network_links</span><span class="p">[</span><span class="s2">&quot;fromnode&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">df_network_links</span><span class="p">[</span><span class="s2">&quot;tonode&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>        

    <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
        <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="nb">id</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">ID</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()):</span>
        <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s2">&quot;classification&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_network_nodes</span><span class="p">[</span><span class="s2">&quot;utilfcltyc&quot;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">G</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Obtain networkX representation of EPN and WDS networks</span>
<span class="n">G_EPN</span> <span class="o">=</span> <span class="n">shp_to_network</span><span class="p">(</span><span class="n">df_EPNnodes</span><span class="p">,</span><span class="n">df_EPNlinks</span><span class="p">)</span>
<span class="n">G_WDS</span> <span class="o">=</span> <span class="n">shp_to_network</span><span class="p">(</span><span class="n">df_WDSnodes</span><span class="p">,</span><span class="n">df_WDSlinks</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Add 100 to node and link IDs of EPN geodataframe to distinguish its node IDs from WDS</span>
<span class="n">df_EPNlinks</span><span class="p">[</span><span class="s1">&#39;linknwid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_EPNlinks</span><span class="p">[</span><span class="s1">&#39;linknwid&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span>
<span class="n">df_EPNlinks</span><span class="p">[</span><span class="s1">&#39;fromnode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_EPNlinks</span><span class="p">[</span><span class="s1">&#39;fromnode&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span>
<span class="n">df_EPNlinks</span><span class="p">[</span><span class="s1">&#39;tonode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_EPNlinks</span><span class="p">[</span><span class="s1">&#39;tonode&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span>
<span class="n">df_EPNnodes</span><span class="p">[</span><span class="s1">&#39;nodenwid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_EPNnodes</span><span class="p">[</span><span class="s1">&#39;nodenwid&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="restoration-analysis-of-epn-components">
<h2>4-2) Restoration Analysis of EPN Components<a class="headerlink" href="#restoration-analysis-of-epn-components" title="Permalink to this heading">#</a></h2>
<p>Restoration curves for electric substations presented in Hazus [5] are emplyed to perform retoration analysis of EPN substations. These functions are presented in Table 8-28 which provide  approximate discrete functions for the restoration of EPN components.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyincore</span> <span class="kn">import</span> <span class="n">RestorationService</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.epfrestoration</span> <span class="kn">import</span> <span class="n">EpfRestoration</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epf_rest</span> <span class="o">=</span> <span class="n">EpfRestoration</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="c1"># Load restoration mapping</span>
<span class="n">restorationsvc</span> <span class="o">=</span> <span class="n">RestorationService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">restorationsvc</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="s2">&quot;61f302e6e3a03e465500b3eb&quot;</span><span class="p">))</span>  <span class="c1"># new format of mapping</span>
<span class="n">epf_rest</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;epfs&quot;</span><span class="p">,</span> <span class="n">epn_dataset</span><span class="p">)</span>
<span class="n">epf_rest</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>
<span class="n">epf_rest</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span> <span class="n">substation_dmg_result</span><span class="p">)</span>
<span class="c1"># result_name = fp + &quot;4_MMSA_epf_restoration_result&quot;</span>
<span class="n">epf_rest</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="s2">&quot;epf_restoration.csv&quot;</span><span class="p">)</span>
<span class="n">epf_rest</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;restoration_key&quot;</span><span class="p">,</span> <span class="s2">&quot;Restoration ID Code&quot;</span><span class="p">)</span>
<span class="n">epf_rest</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">)</span>
<span class="n">epf_rest</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;time_interval&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="c1"># epf_rest.set_parameter(&quot;pf_interval&quot;, 0.01)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epf_rest</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>

<span class="c1"># Discretized Restoration functionality</span>
<span class="n">func_results</span> <span class="o">=</span> <span class="n">epf_rest</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;func_results&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">func_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>day1</th>
      <th>day3</th>
      <th>day7</th>
      <th>day30</th>
      <th>day90</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>75941d02-93bf-4ef9-87d3-d882384f6c10</td>
      <td>0.335675</td>
      <td>0.686150</td>
      <td>0.923376</td>
      <td>0.991957</td>
      <td>0.999999</td>
    </tr>
    <tr>
      <th>1</th>
      <td>35909c93-4b29-4616-9cd3-989d8d604481</td>
      <td>0.351585</td>
      <td>0.702574</td>
      <td>0.930482</td>
      <td>0.992979</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ce7d3164-ffda-4ac0-a9fa-d88c927897cc</td>
      <td>0.370245</td>
      <td>0.720985</td>
      <td>0.938007</td>
      <td>0.994010</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>b2bed3e1-f16c-483a-98e8-79dfd849d187</td>
      <td>0.412081</td>
      <td>0.759188</td>
      <td>0.952183</td>
      <td>0.995803</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ab011d7c-0e34-4e5d-9734-34f7858d4b68</td>
      <td>0.413603</td>
      <td>0.760503</td>
      <td>0.952637</td>
      <td>0.995857</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epf_time_results</span> <span class="o">=</span> <span class="n">epf_rest</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;time_results&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">epf_time_results</span> <span class="o">=</span> <span class="n">epf_time_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">epf_time_results</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">epf_time_results</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">epf_time_results</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">7</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">epf_time_results</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">30</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">epf_time_results</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">90</span><span class="p">)]</span>
<span class="n">epf_time_results</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;PF_00&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">epf_time_results</span><span class="p">))))</span> <span class="c1"># PF_00, PF_0, PF_1, PF_2, PF_3  ---&gt; DS_0, DS_1, DS_2, DS_3, DS_4</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_EPN_node</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_EPNnodes</span><span class="p">[[</span><span class="s1">&#39;nodenwid&#39;</span><span class="p">,</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">,</span><span class="s1">&#39;guid&#39;</span><span class="p">]],</span> <span class="n">df_substation_fail</span><span class="p">[[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span><span class="s1">&#39;DS_0&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_1&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_2&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_3&#39;</span><span class="p">,</span><span class="s1">&#39;DS_4&#39;</span><span class="p">,</span> <span class="s1">&#39;failure_probability&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
<span class="n">epf_inventory_restoration_map</span> <span class="o">=</span> <span class="n">epf_rest</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;inventory_restoration_map&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">EPPL_restoration_id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">epf_inventory_restoration_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">epf_inventory_restoration_map</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">df_EPN_node</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_EPN_node</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;EPPL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">guid</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;restoration_id&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ESS_restoration_id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">epf_inventory_restoration_map</span><span class="o">.</span><span class="n">restoration_id</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="o">-</span><span class="nb">set</span><span class="p">([</span><span class="n">EPPL_restoration_id</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df_EPN_node_EPPL</span> <span class="o">=</span> <span class="n">df_EPN_node</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_EPN_node</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;EPPL&#39;</span><span class="p">]</span>
<span class="n">df_EPN_node_ESS</span> <span class="o">=</span> <span class="n">df_EPN_node</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_EPN_node</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;EPPL&#39;</span><span class="p">]</span>
<span class="n">epf_time_results_EPPL</span> <span class="o">=</span> <span class="n">epf_time_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">epf_time_results</span><span class="p">[</span><span class="s1">&#39;restoration_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">EPPL_restoration_id</span><span class="p">][[</span><span class="s1">&#39;PF_00&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_0&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_1&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_2&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_3&#39;</span><span class="p">]]</span> 
<span class="n">EPPL_func_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">df_EPN_node_EPPL</span><span class="p">[[</span><span class="s1">&#39;DS_0&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_1&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_2&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_3&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_4&#39;</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">epf_time_results_EPPL</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;functionality1&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality3&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality7&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality30&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality90&#39;</span><span class="p">])</span>
<span class="n">EPPL_func_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_EPN_node_EPPL</span><span class="o">.</span><span class="n">guid</span><span class="p">))</span>
<span class="n">epf_time_results_ESS</span> <span class="o">=</span> <span class="n">epf_time_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">epf_time_results</span><span class="p">[</span><span class="s1">&#39;restoration_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">ESS_restoration_id</span><span class="p">][[</span><span class="s1">&#39;PF_00&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_0&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_1&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_2&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_3&#39;</span><span class="p">]]</span> 
<span class="n">ESS_func_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">df_EPN_node_ESS</span><span class="p">[[</span><span class="s1">&#39;DS_0&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_1&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_2&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_3&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_4&#39;</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">epf_time_results_ESS</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;functionality1&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality3&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality7&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality30&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality90&#39;</span><span class="p">])</span>
<span class="n">ESS_func_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_EPN_node_ESS</span><span class="o">.</span><span class="n">guid</span><span class="p">))</span>
<span class="n">epf_function_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ESS_func_df</span><span class="p">,</span> <span class="n">EPPL_func_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_EPN_node</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_EPN_node</span><span class="p">,</span> <span class="n">epf_function_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;guid&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_EPN_node</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nodenwid</th>
      <th>utilfcltyc</th>
      <th>guid</th>
      <th>DS_0</th>
      <th>DS_1</th>
      <th>DS_2</th>
      <th>DS_3</th>
      <th>DS_4</th>
      <th>failure_probability</th>
      <th>functionality1</th>
      <th>functionality3</th>
      <th>functionality7</th>
      <th>functionality30</th>
      <th>functionality90</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>159</td>
      <td>ESSL</td>
      <td>75941d02-93bf-4ef9-87d3-d882384f6c10</td>
      <td>0.112567</td>
      <td>0.364409</td>
      <td>0.386813</td>
      <td>0.120125</td>
      <td>0.016086</td>
      <td>0.1345</td>
      <td>0.335675</td>
      <td>0.686150</td>
      <td>0.923376</td>
      <td>0.991957</td>
      <td>0.999999</td>
    </tr>
    <tr>
      <th>1</th>
      <td>158</td>
      <td>ESSL</td>
      <td>35909c93-4b29-4616-9cd3-989d8d604481</td>
      <td>0.124117</td>
      <td>0.376121</td>
      <td>0.375889</td>
      <td>0.109831</td>
      <td>0.014042</td>
      <td>0.1217</td>
      <td>0.351585</td>
      <td>0.702574</td>
      <td>0.930482</td>
      <td>0.992979</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>157</td>
      <td>ESSL</td>
      <td>ce7d3164-ffda-4ac0-a9fa-d88c927897cc</td>
      <td>0.138333</td>
      <td>0.388538</td>
      <td>0.362398</td>
      <td>0.098751</td>
      <td>0.011980</td>
      <td>0.1114</td>
      <td>0.370245</td>
      <td>0.720985</td>
      <td>0.938007</td>
      <td>0.994010</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>156</td>
      <td>ESSL</td>
      <td>b2bed3e1-f16c-483a-98e8-79dfd849d187</td>
      <td>0.172799</td>
      <td>0.411180</td>
      <td>0.330260</td>
      <td>0.077368</td>
      <td>0.008394</td>
      <td>0.0856</td>
      <td>0.412081</td>
      <td>0.759188</td>
      <td>0.952183</td>
      <td>0.995803</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>155</td>
      <td>ESSL</td>
      <td>ab011d7c-0e34-4e5d-9734-34f7858d4b68</td>
      <td>0.174120</td>
      <td>0.411868</td>
      <td>0.329056</td>
      <td>0.076671</td>
      <td>0.008286</td>
      <td>0.0878</td>
      <td>0.413603</td>
      <td>0.760503</td>
      <td>0.952637</td>
      <td>0.995857</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="restoration-analysis-of-wds-components">
<h2>4-3) Restoration Analysis of WDS Components<a class="headerlink" href="#restoration-analysis-of-wds-components" title="Permalink to this heading">#</a></h2>
<p>Restoration curves for WDS presented in Hazus are emplyed to perform retoration analysis of WDS nodes. These functions are presented in Table 8-2, which provide  approximate discrete functions for the restoration of Potable Water System Components.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyincore.analyses.waterfacilityrestoration</span> <span class="kn">import</span> <span class="n">WaterFacilityRestoration</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf_rest</span> <span class="o">=</span> <span class="n">WaterFacilityRestoration</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="c1"># Load restoration mapping</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">restorationsvc</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="s2">&quot;61f075ee903e515036cee0a5&quot;</span><span class="p">))</span>  <span class="c1"># new format of mapping</span>
<span class="n">wf_rest</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;water_facilities&quot;</span><span class="p">,</span> <span class="s2">&quot;5a284f2ac7d30d13bc081e52&quot;</span><span class="p">)</span>  <span class="c1"># water facility</span>
<span class="n">wf_rest</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>
<span class="n">wf_rest</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span> <span class="n">waterfacility_dmg_result</span><span class="p">)</span>
<span class="n">wf_rest</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="s2">&quot;wf_restoration&quot;</span><span class="p">)</span>
<span class="n">wf_rest</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;restoration_key&quot;</span><span class="p">,</span> <span class="s2">&quot;Restoration ID Code&quot;</span><span class="p">)</span>
<span class="n">wf_rest</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">)</span>
<span class="n">wf_rest</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;time_interval&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf_rest</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Discretized Restoration functionality</span>
<span class="n">wf_func_results</span> <span class="o">=</span> <span class="n">wf_rest</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;func_results&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">wf_func_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">wf_time_results</span> <span class="o">=</span> <span class="n">wf_rest</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;time_results&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">wf_time_results</span> <span class="o">=</span> <span class="n">wf_time_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">wf_time_results</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">wf_time_results</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">wf_time_results</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">7</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">wf_time_results</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">30</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">wf_time_results</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">90</span><span class="p">)]</span>
<span class="n">wf_time_results</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;PF_00&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wf_time_results</span><span class="p">))))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_WDS_node</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_WDSnodes</span><span class="p">[[</span><span class="s1">&#39;nodenwid&#39;</span><span class="p">,</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">,</span><span class="s1">&#39;guid&#39;</span><span class="p">]],</span> <span class="n">df_waterfacility_dmg</span><span class="p">[[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_0&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_1&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_2&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_3&#39;</span><span class="p">,</span><span class="s1">&#39;DS_4&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf_inventory_restoration_map</span> <span class="o">=</span> <span class="n">wf_rest</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;inventory_restoration_map&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">PPPL_restoration_id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">wf_inventory_restoration_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">wf_inventory_restoration_map</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">df_WDS_node</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_WDS_node</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PPPL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">guid</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;restoration_id&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">PSTAS_restoration_id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">wf_inventory_restoration_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">wf_inventory_restoration_map</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">df_WDS_node</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_WDS_node</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PSTAS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">guid</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;restoration_id&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df_WDS_node_PPPL</span> <span class="o">=</span> <span class="n">df_WDS_node</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_WDS_node</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PPPL&#39;</span><span class="p">]</span>
<span class="n">df_WDS_node_PSTAS</span> <span class="o">=</span> <span class="n">df_WDS_node</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_WDS_node</span><span class="p">[</span><span class="s1">&#39;utilfcltyc&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PSTAS&#39;</span><span class="p">]</span>

<span class="n">wf_time_results_PPPL</span> <span class="o">=</span> <span class="n">wf_time_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">wf_time_results</span><span class="p">[</span><span class="s1">&#39;restoration_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">PPPL_restoration_id</span><span class="p">][[</span><span class="s1">&#39;PF_00&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_0&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_1&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_2&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_3&#39;</span><span class="p">]]</span> 
<span class="n">PPPL_func_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">df_WDS_node_PPPL</span><span class="p">[[</span><span class="s1">&#39;DS_0&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_1&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_2&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_3&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_4&#39;</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wf_time_results_PPPL</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;functionality1&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality3&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality7&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality30&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality90&#39;</span><span class="p">])</span>
<span class="n">PPPL_func_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_WDS_node_PPPL</span><span class="o">.</span><span class="n">guid</span><span class="p">))</span>

<span class="n">wf_time_results_PSTAS</span> <span class="o">=</span> <span class="n">wf_time_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">wf_time_results</span><span class="p">[</span><span class="s1">&#39;restoration_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">PSTAS_restoration_id</span><span class="p">][[</span><span class="s1">&#39;PF_00&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_0&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_1&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_2&#39;</span><span class="p">,</span> <span class="s1">&#39;PF_3&#39;</span><span class="p">]]</span> 
<span class="n">PSTAS_func_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">df_WDS_node_PSTAS</span><span class="p">[[</span><span class="s1">&#39;DS_0&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_1&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_2&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_3&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_4&#39;</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wf_time_results_PSTAS</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;functionality1&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality3&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality7&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality30&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality90&#39;</span><span class="p">])</span>
<span class="n">PSTAS_func_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_WDS_node_PSTAS</span><span class="o">.</span><span class="n">guid</span><span class="p">))</span>

<span class="n">wf_function_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">PSTAS_func_df</span><span class="p">,</span> <span class="n">PPPL_func_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_WDS_node</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_WDS_node</span><span class="p">,</span> <span class="n">wf_function_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;guid&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_WDS_node</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nodenwid</th>
      <th>utilfcltyc</th>
      <th>guid</th>
      <th>DS_0</th>
      <th>DS_1</th>
      <th>DS_2</th>
      <th>DS_3</th>
      <th>DS_4</th>
      <th>functionality1</th>
      <th>functionality3</th>
      <th>functionality7</th>
      <th>functionality30</th>
      <th>functionality90</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>49</td>
      <td>PSTAS</td>
      <td>a007a9b0-c2ec-4bdc-beec-8c92e3b515dd</td>
      <td>0.079319</td>
      <td>0.320266</td>
      <td>0.416574</td>
      <td>0.158884</td>
      <td>0.024956</td>
      <td>0.293752</td>
      <td>0.627292</td>
      <td>0.812677</td>
      <td>0.856304</td>
      <td>0.900703</td>
    </tr>
    <tr>
      <th>1</th>
      <td>48</td>
      <td>PSTAS</td>
      <td>5a968e23-b0d3-4677-abd1-5767f3cad8ee</td>
      <td>0.059847</td>
      <td>0.284431</td>
      <td>0.430426</td>
      <td>0.191339</td>
      <td>0.033957</td>
      <td>0.271674</td>
      <td>0.584331</td>
      <td>0.776228</td>
      <td>0.823629</td>
      <td>0.877664</td>
    </tr>
    <tr>
      <th>2</th>
      <td>47</td>
      <td>PSTAS</td>
      <td>22206135-813f-4455-9f42-7cff7b21688c</td>
      <td>0.060465</td>
      <td>0.285723</td>
      <td>0.430069</td>
      <td>0.190145</td>
      <td>0.033598</td>
      <td>0.272411</td>
      <td>0.585857</td>
      <td>0.777582</td>
      <td>0.824855</td>
      <td>0.878531</td>
    </tr>
    <tr>
      <th>3</th>
      <td>46</td>
      <td>PSTAS</td>
      <td>e1bce78d-00a1-4605-95f3-3776ff907f73</td>
      <td>0.069978</td>
      <td>0.304238</td>
      <td>0.423795</td>
      <td>0.173241</td>
      <td>0.028748</td>
      <td>0.283424</td>
      <td>0.607895</td>
      <td>0.796641</td>
      <td>0.842011</td>
      <td>0.890645</td>
    </tr>
    <tr>
      <th>4</th>
      <td>45</td>
      <td>PSTAS</td>
      <td>ddadb420-6057-49f6-8d29-3467906a1452</td>
      <td>0.068015</td>
      <td>0.300611</td>
      <td>0.425195</td>
      <td>0.176524</td>
      <td>0.029656</td>
      <td>0.281196</td>
      <td>0.603552</td>
      <td>0.792957</td>
      <td>0.838708</td>
      <td>0.888317</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="networkx-modeling-of-interdependent-epn-and-wds-networks">
<h2>4-4) NetworkX modeling of interdependent EPN and WDS networks<a class="headerlink" href="#networkx-modeling-of-interdependent-epn-and-wds-networks" title="Permalink to this heading">#</a></h2>
<section id="a-the-epn-and-wds-pecentage-functionality-dataframes-are-combined-in-this-section-to-obtain-an-interdependent-networkx-model-of-epn-and-wds">
<h3>4-4-A) The EPN and WDS pecentage functionality dataframes are combined in this section to obtain an interdependent networkX model of EPN and WDS.<a class="headerlink" href="#a-the-epn-and-wds-pecentage-functionality-dataframes-are-combined-in-this-section-to-obtain-an-interdependent-networkx-model-of-epn-and-wds" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_functionality_nodes</span> <span class="o">=</span> <span class="n">df_EPN_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_WDS_node</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_network_nodes</span> <span class="o">=</span> <span class="n">df_EPNnodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_WDSnodes</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_network_links</span> <span class="o">=</span> <span class="n">df_EPNlinks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_WDSlinks</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_127437/385125541.py:1: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  df_functionality_nodes = df_EPN_node.append(df_WDS_node, ignore_index=True)
/tmp/ipykernel_127437/385125541.py:2: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  df_network_nodes = df_EPNnodes.append(df_WDSnodes, ignore_index=True)
/tmp/ipykernel_127437/385125541.py:3: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  df_network_links = df_EPNlinks.append(df_WDSlinks, ignore_index=True)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Obtain an interdepentend graph model of networks</span>
<span class="n">G_WDS_EPN_Full</span> <span class="o">=</span> <span class="n">shp_to_network</span><span class="p">(</span><span class="n">df_network_nodes</span><span class="p">,</span><span class="n">df_network_links</span><span class="p">)</span>
<span class="n">G_EPN_WDS_Full</span> <span class="o">=</span> <span class="n">shp_to_network</span><span class="p">(</span><span class="n">df_network_nodes</span><span class="p">,</span><span class="n">df_network_links</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="b-assign-si-values-obtained-from-pipeline-repair-analysis-as-weight-to-networkx-model">
<h3>4-4-B) Assign SI values obtained from pipeline repair analysis as weight to networkX model<a class="headerlink" href="#b-assign-si-values-obtained-from-pipeline-repair-analysis-as-weight-to-networkx-model" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="n">df_WDS_node</span><span class="p">[</span><span class="s1">&#39;nodenwid&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">G_WDS_EPN_Full</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">nodes</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">G_WDS_EPN_Full</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">nodes</span><span class="p">)):</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="n">df_WDSlinks</span><span class="p">[</span><span class="n">df_WDSlinks</span><span class="p">[</span><span class="s1">&#39;fromnode&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">SI_break_idv</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">G_WDS_EPN_Full</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">nodes</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
            <span class="n">G_EPN_WDS_Full</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">nodes</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="c-define-the-dependency-between-epn-and-wds-with-additional-edges-within-the-networkx-model">
<h3>4-4-C) Define the dependency between EPN and WDS with additional edges within the networkX model<a class="headerlink" href="#c-define-the-dependency-between-epn-and-wds-with-additional-edges-within-the-networkx-model" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">origin_EPN</span> <span class="o">=</span> <span class="p">[</span><span class="mi">113</span><span class="p">,</span><span class="mi">116</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">127</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">132</span><span class="p">,</span><span class="mi">135</span><span class="p">,</span><span class="mi">137</span><span class="p">,</span><span class="mi">139</span><span class="p">]</span>
<span class="n">destination_WDS</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">4</span>  <span class="p">,</span><span class="mi">5</span>  <span class="p">,</span><span class="mi">12</span> <span class="p">,</span><span class="mi">2</span>  <span class="p">,</span><span class="mi">3</span>  <span class="p">,</span><span class="mi">6</span>  <span class="p">,</span><span class="mi">8</span>  <span class="p">,</span><span class="mi">9</span>  <span class="p">,</span><span class="mi">11</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">origin_EPN</span><span class="p">,</span> <span class="n">destination_WDS</span><span class="p">):</span>
    <span class="n">G_WDS_EPN_Full</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">origin_WDS</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">21</span><span class="p">,</span>  <span class="mi">25</span><span class="p">,</span>  <span class="mi">23</span> <span class="p">,</span>  <span class="mi">29</span><span class="p">,</span>  <span class="mi">30</span><span class="p">,</span>  <span class="mi">35</span><span class="p">,</span>  <span class="mi">39</span><span class="p">,</span> <span class="mi">42</span><span class="p">]</span>
<span class="n">destination_EPN</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">103</span> <span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">108</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">origin_WDS</span><span class="p">,</span><span class="n">destination_EPN</span><span class="p">):</span>
    <span class="n">G_EPN_WDS_Full</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="implemention-of-an-input-output-model-to-estimate-the-functionality-of-epn-nodes-by-accounting-for-dependency-between-epn-and-wds-networks">
<h2>4-5) Implemention of an Input-Output model to estimate the functionality of EPN nodes by accounting for dependency between EPN and WDS networks<a class="headerlink" href="#implemention-of-an-input-output-model-to-estimate-the-functionality-of-epn-nodes-by-accounting-for-dependency-between-epn-and-wds-networks" title="Permalink to this heading">#</a></h2>
<p>The functionality estimates obtained for buildings, EPN and WDS are used as input to an input-output (I-O) model [6] to simulate the functionality of components by accounting for the interdependency between networked infrastructure.</p>
<p>An I-O model uses a perturbation vector, given by $u$, to capture the inoperability of the components of a disrupted interconnected system due to cascading effects.</p>
<p>$$
q=M(G)q+u
$$</p>
<p>where $u = [u_1,u_2,…,u_n]^T$; $u_i∈[0,1]⊂R$ is the perturbation vector obtained from non-functionality of individual network components subject to seismic hazard and $q=[q_1,q_2,…,q_n]^T]$; $q_i∈[0,∞)⊂R$ is the resulting non-functionality vector due to their connections to the perturbed infrastructure components and their cascading failure. The non-functionally vector $q$ can be calculated as follows:</p>
<p>$$
q=(I-M(G)^T)^{-1} u
$$</p>
<p>Ultimately, functionality vector can be calculated as</p>
<p>$$
functionality = 1-q
$$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtain percent functionality estimates days after the event by running the input-output model</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">90</span><span class="p">]:</span>
    <span class="n">day</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">inv</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">adjacency_matrix</span><span class="p">(</span><span class="n">G_EPN_WDS_Full</span><span class="p">)</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>

    <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">df_functionality_nodes</span><span class="p">[</span><span class="s1">&#39;functionality&#39;</span><span class="o">+</span><span class="n">day</span><span class="p">]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
    
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">M</span><span class="o">.</span><span class="n">T</span><span class="p">),</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">funct</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span><span class="o">-</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">q</span><span class="p">]</span>
    <span class="n">df_functionality_nodes</span><span class="p">[</span><span class="s1">&#39;func_cascading&#39;</span><span class="o">+</span> <span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">funct</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_127437/1871123708.py:6: FutureWarning: adjacency_matrix will return a scipy.sparse array instead of a matrix in Networkx 3.0.
  M = nx.adjacency_matrix(G_EPN_WDS_Full).todense()
/tmp/ipykernel_127437/1871123708.py:6: FutureWarning: adjacency_matrix will return a scipy.sparse array instead of a matrix in Networkx 3.0.
  M = nx.adjacency_matrix(G_EPN_WDS_Full).todense()
/tmp/ipykernel_127437/1871123708.py:6: FutureWarning: adjacency_matrix will return a scipy.sparse array instead of a matrix in Networkx 3.0.
  M = nx.adjacency_matrix(G_EPN_WDS_Full).todense()
/tmp/ipykernel_127437/1871123708.py:6: FutureWarning: adjacency_matrix will return a scipy.sparse array instead of a matrix in Networkx 3.0.
  M = nx.adjacency_matrix(G_EPN_WDS_Full).todense()
/tmp/ipykernel_127437/1871123708.py:6: FutureWarning: adjacency_matrix will return a scipy.sparse array instead of a matrix in Networkx 3.0.
  M = nx.adjacency_matrix(G_EPN_WDS_Full).todense()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># update the column attribute for substations to &#39;sugid&#39;</span>
<span class="n">df_functionality_nodes</span> <span class="o">=</span> <span class="n">df_EPNnodes</span><span class="p">[[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_functionality_nodes</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;guid&#39;</span><span class="p">:</span> <span class="s1">&#39;sguid&#39;</span><span class="p">})</span>
<span class="n">df_functionality_nodes</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sguid</th>
      <th>geometry</th>
      <th>nodenwid</th>
      <th>utilfcltyc</th>
      <th>DS_0</th>
      <th>DS_1</th>
      <th>DS_2</th>
      <th>DS_3</th>
      <th>DS_4</th>
      <th>failure_probability</th>
      <th>functionality1</th>
      <th>functionality3</th>
      <th>functionality7</th>
      <th>functionality30</th>
      <th>functionality90</th>
      <th>func_cascading1</th>
      <th>func_cascading3</th>
      <th>func_cascading7</th>
      <th>func_cascading30</th>
      <th>func_cascading90</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>75941d02-93bf-4ef9-87d3-d882384f6c10</td>
      <td>POINT (-89.83611 35.28708)</td>
      <td>159</td>
      <td>ESSL</td>
      <td>0.112567</td>
      <td>0.364409</td>
      <td>0.386813</td>
      <td>0.120125</td>
      <td>0.016086</td>
      <td>0.1345</td>
      <td>0.335675</td>
      <td>0.686150</td>
      <td>0.923376</td>
      <td>0.991957</td>
      <td>0.999999</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.478205</td>
      <td>0.788938</td>
    </tr>
    <tr>
      <th>1</th>
      <td>35909c93-4b29-4616-9cd3-989d8d604481</td>
      <td>POINT (-89.84449 35.26734)</td>
      <td>158</td>
      <td>ESSL</td>
      <td>0.124117</td>
      <td>0.376121</td>
      <td>0.375889</td>
      <td>0.109831</td>
      <td>0.014042</td>
      <td>0.1217</td>
      <td>0.351585</td>
      <td>0.702574</td>
      <td>0.930482</td>
      <td>0.992979</td>
      <td>1.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.342539</td>
      <td>0.757737</td>
      <td>0.897922</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ce7d3164-ffda-4ac0-a9fa-d88c927897cc</td>
      <td>POINT (-89.98442 35.24436)</td>
      <td>157</td>
      <td>ESSL</td>
      <td>0.138333</td>
      <td>0.388538</td>
      <td>0.362398</td>
      <td>0.098751</td>
      <td>0.011980</td>
      <td>0.1114</td>
      <td>0.370245</td>
      <td>0.720985</td>
      <td>0.938007</td>
      <td>0.994010</td>
      <td>1.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.386594</td>
      <td>0.786241</td>
      <td>0.915350</td>
    </tr>
    <tr>
      <th>3</th>
      <td>b2bed3e1-f16c-483a-98e8-79dfd849d187</td>
      <td>POINT (-89.95621 35.19269)</td>
      <td>156</td>
      <td>ESSL</td>
      <td>0.172799</td>
      <td>0.411180</td>
      <td>0.330260</td>
      <td>0.077368</td>
      <td>0.008394</td>
      <td>0.0856</td>
      <td>0.412081</td>
      <td>0.759188</td>
      <td>0.952183</td>
      <td>0.995803</td>
      <td>1.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.006592</td>
      <td>0.662829</td>
      <td>0.859766</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ab011d7c-0e34-4e5d-9734-34f7858d4b68</td>
      <td>POINT (-89.97992 35.19191)</td>
      <td>155</td>
      <td>ESSL</td>
      <td>0.174120</td>
      <td>0.411868</td>
      <td>0.329056</td>
      <td>0.076671</td>
      <td>0.008286</td>
      <td>0.0878</td>
      <td>0.413603</td>
      <td>0.760503</td>
      <td>0.952637</td>
      <td>0.995857</td>
      <td>1.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.366047</td>
      <td>0.785443</td>
      <td>0.915350</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="functionality-of-epn-7-and-30-days-after-event">
<h3>Functionality of EPN 7 and 30 days after event<a class="headerlink" href="#functionality-of-epn-7-and-30-days-after-event" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">day</span> <span class="o">=</span> <span class="s1">&#39;7&#39;</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df_functionality_nodes</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;nodenwid&gt;100&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;func_cascading&#39;</span><span class="o">+</span> <span class="n">day</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet_r&#39;</span><span class="p">,</span>  <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_EPNlinks</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">day</span> <span class="o">=</span> <span class="s1">&#39;30&#39;</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df_functionality_nodes</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;nodenwid&gt;100&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;func_cascading&#39;</span><span class="o">+</span> <span class="n">day</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet_r&#39;</span><span class="p">,</span>  <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_EPNlinks</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/4228392c90949dd887f7cd6fba84b3e12f324274adfecc49a8cc1d7b47b5db3a.png" src="../../_images/4228392c90949dd887f7cd6fba84b3e12f324274adfecc49a8cc1d7b47b5db3a.png" />
<img alt="../../_images/05824b7336e28460d5912e21f6cd4850db27f4deb8fa16b3ae77877a8d037730.png" src="../../_images/05824b7336e28460d5912e21f6cd4850db27f4deb8fa16b3ae77877a8d037730.png" />
</div>
</div>
</section>
<section id="a-analysisi-of-wds-functionality-estimates-obtained-from-i-o-model">
<h3>4-5-A) Analysisi of WDS Functionality Estimates obtained from I-O model<a class="headerlink" href="#a-analysisi-of-wds-functionality-estimates-obtained-from-i-o-model" title="Permalink to this heading">#</a></h3>
<p>In this section, we map the WDS functionality estimates to general functional and nonfucntional categories. According to Hazus [5], WDS functionality can be classified as follows:</p>
<p>•  0-25% functionality – building/facility is likely to be non-functional<br />
•  25-75% functionality – building/facility is likely to allow limited operations (e.g., selected parts of the building/facility may be used)<br />
•  75-100% functionality – building/facility is likely to be functional</p>
<p>This notebook assumes functionality 0-25% as non-functional and 25-100% as functional.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_wf_functionality</span> <span class="o">=</span> <span class="n">df_functionality_nodes</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;nodenwid&lt;100&#39;</span><span class="p">)[[</span><span class="s1">&#39;nodenwid&#39;</span><span class="p">,</span><span class="s1">&#39;sguid&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality1&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality3&#39;</span><span class="p">,</span>
       <span class="s1">&#39;functionality7&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality30&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality90&#39;</span><span class="p">,</span>
       <span class="s1">&#39;func_cascading1&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading3&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading7&#39;</span><span class="p">,</span>
       <span class="s1">&#39;func_cascading30&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading90&#39;</span><span class="p">]]</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;functionality1&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality3&#39;</span><span class="p">,</span>
       <span class="s1">&#39;functionality7&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality30&#39;</span><span class="p">,</span> <span class="s1">&#39;functionality90&#39;</span><span class="p">,</span>
       <span class="s1">&#39;func_cascading1&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading3&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading7&#39;</span><span class="p">,</span>
       <span class="s1">&#39;func_cascading30&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading90&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
    <span class="n">df_wf_functionality</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_wf_functionality</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">&lt;</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="n">df_wf_functionality</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="mf">0.25</span><span class="o">&lt;=</span><span class="n">df_wf_functionality</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_wf_functionality</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.75</span><span class="p">),</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">df_wf_functionality</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_wf_functionality</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">df_wf_functionality</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nodenwid</th>
      <th>sguid</th>
      <th>functionality1</th>
      <th>functionality3</th>
      <th>functionality7</th>
      <th>functionality30</th>
      <th>functionality90</th>
      <th>func_cascading1</th>
      <th>func_cascading3</th>
      <th>func_cascading7</th>
      <th>func_cascading30</th>
      <th>func_cascading90</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ss_functionality</span> <span class="o">=</span> <span class="n">df_functionality_nodes</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;nodenwid&gt;100&#39;</span><span class="p">)[[</span><span class="s1">&#39;nodenwid&#39;</span><span class="p">,</span><span class="s1">&#39;sguid&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading1&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading3&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading7&#39;</span><span class="p">,</span>
       <span class="s1">&#39;func_cascading30&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading90&#39;</span><span class="p">]]</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;func_cascading1&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading3&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading7&#39;</span><span class="p">,</span>
       <span class="s1">&#39;func_cascading30&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading90&#39;</span><span class="p">]</span>
<span class="n">df_ss_functionality</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nodenwid</th>
      <th>sguid</th>
      <th>func_cascading1</th>
      <th>func_cascading3</th>
      <th>func_cascading7</th>
      <th>func_cascading30</th>
      <th>func_cascading90</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>159</td>
      <td>75941d02-93bf-4ef9-87d3-d882384f6c10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.478205</td>
      <td>0.788938</td>
    </tr>
    <tr>
      <th>1</th>
      <td>158</td>
      <td>35909c93-4b29-4616-9cd3-989d8d604481</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.342539</td>
      <td>0.757737</td>
      <td>0.897922</td>
    </tr>
    <tr>
      <th>2</th>
      <td>157</td>
      <td>ce7d3164-ffda-4ac0-a9fa-d88c927897cc</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.386594</td>
      <td>0.786241</td>
      <td>0.915350</td>
    </tr>
    <tr>
      <th>3</th>
      <td>156</td>
      <td>b2bed3e1-f16c-483a-98e8-79dfd849d187</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.006592</td>
      <td>0.662829</td>
      <td>0.859766</td>
    </tr>
    <tr>
      <th>4</th>
      <td>155</td>
      <td>ab011d7c-0e34-4e5d-9734-34f7858d4b68</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.366047</td>
      <td>0.785443</td>
      <td>0.915350</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_bldg_functionality</span> <span class="o">=</span> <span class="n">df_bldg_func</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;functionality&#39;</span><span class="p">:</span><span class="s1">&#39;bldg_functionality&#39;</span><span class="p">})[[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span><span class="s1">&#39;bldg_functionality&#39;</span><span class="p">]]</span>
<span class="n">df_EPN_Bldg_Depend</span> <span class="o">=</span> <span class="n">df_EPN_Bldg_Depend</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_ss_functionality</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;sguid&#39;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">df_EPN_Bldg_Depend</span> <span class="o">=</span> <span class="n">df_EPN_Bldg_Depend</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_bldg_functionality</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">df_EPN_Bldg_Depend</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>guid</th>
      <th>sguid</th>
      <th>nodenwid</th>
      <th>func_cascading1</th>
      <th>func_cascading3</th>
      <th>func_cascading7</th>
      <th>func_cascading30</th>
      <th>func_cascading90</th>
      <th>bldg_functionality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>4014e650-a282-47a0-8b05-be64f92541fe</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
      <td>145</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.226151</td>
      <td>0.686798</td>
      <td>0.882183</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>c57a33ff-9cf9-45ec-9c2e-86bba4d585a1</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
      <td>145</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.226151</td>
      <td>0.686798</td>
      <td>0.882183</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>398ef608-bcf8-4a15-bfc8-01273c9c36c2</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
      <td>145</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.226151</td>
      <td>0.686798</td>
      <td>0.882183</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>0d96300b-0301-41c2-b19c-85a3c8f4c142</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
      <td>145</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.226151</td>
      <td>0.686798</td>
      <td>0.882183</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>25e640e5-f6ae-4b6d-a777-4dfcbb818961</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
      <td>145</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.226151</td>
      <td>0.686798</td>
      <td>0.882183</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>304958</th>
      <td>304958</td>
      <td>b378cd1b-d00e-4f0d-9300-163b19b48282</td>
      <td>6a6edd82-02d8-4d5d-9089-9739ab9762ed</td>
      <td>109</td>
      <td>0.800225</td>
      <td>0.845105</td>
      <td>0.934246</td>
      <td>0.986213</td>
      <td>0.999459</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>304959</th>
      <td>304959</td>
      <td>078f7f26-d519-4909-8d94-76ea2ddcdd92</td>
      <td>6a6edd82-02d8-4d5d-9089-9739ab9762ed</td>
      <td>109</td>
      <td>0.800225</td>
      <td>0.845105</td>
      <td>0.934246</td>
      <td>0.986213</td>
      <td>0.999459</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>304960</th>
      <td>304960</td>
      <td>35e22845-8567-4cc7-bf92-71f2dba3b70e</td>
      <td>6a6edd82-02d8-4d5d-9089-9739ab9762ed</td>
      <td>109</td>
      <td>0.800225</td>
      <td>0.845105</td>
      <td>0.934246</td>
      <td>0.986213</td>
      <td>0.999459</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>304961</th>
      <td>304961</td>
      <td>643f77df-8f95-4b61-9209-87a3ede12873</td>
      <td>6a6edd82-02d8-4d5d-9089-9739ab9762ed</td>
      <td>109</td>
      <td>0.800225</td>
      <td>0.845105</td>
      <td>0.934246</td>
      <td>0.986213</td>
      <td>0.999459</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>304962</th>
      <td>304962</td>
      <td>0becf467-41d6-41ce-9fe4-7600e3dbfcb7</td>
      <td>6a6edd82-02d8-4d5d-9089-9739ab9762ed</td>
      <td>109</td>
      <td>0.800225</td>
      <td>0.845105</td>
      <td>0.934246</td>
      <td>0.986213</td>
      <td>0.999459</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>304963 rows × 10 columns</p>
</div></div></div>
</div>
<p>The following code generates samples to simulates the pecentage of buildings nonfunctional given the functionality percantage of substations obtained previously. The mean of functionality estimates obtained from multiplying the functionality of buildings and their associated EPN substation gives the functionality of each building.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_EPN_Bldg_Depend_MC</span> <span class="o">=</span> <span class="n">df_EPN_Bldg_Depend</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="s1">&#39;sguid&#39;</span><span class="p">,</span> <span class="s1">&#39;nodenwid&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading1&#39;</span><span class="p">,</span><span class="s1">&#39;func_cascading3&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading7&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading30&#39;</span><span class="p">,</span><span class="s1">&#39;func_cascading90&#39;</span><span class="p">]</span>
<span class="n">df_EPN_Bldg_functionality</span> <span class="o">=</span>  <span class="n">df_EPN_Bldg_Depend</span><span class="p">[[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="s1">&#39;sguid&#39;</span><span class="p">,</span> <span class="s1">&#39;nodenwid&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading1&#39;</span><span class="p">,</span>
       <span class="s1">&#39;func_cascading3&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading7&#39;</span><span class="p">,</span> <span class="s1">&#39;func_cascading30&#39;</span><span class="p">,</span>
       <span class="s1">&#39;func_cascading90&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>
    <span class="n">df_EPN_Bldg_functionality</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">no_samples</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">for</span> <span class="n">MC_sample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">no_samples</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">sguid</span> <span class="ow">in</span> <span class="n">df_EPN_Bldg_Depend_MC</span><span class="o">.</span><span class="n">sguid</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">ss_row</span>  <span class="o">=</span> <span class="n">df_ss_functionality</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_ss_functionality</span><span class="p">[</span><span class="s1">&#39;sguid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sguid</span><span class="p">]</span>
        <span class="n">bldg_rows</span> <span class="o">=</span> <span class="n">df_EPN_Bldg_Depend_MC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_EPN_Bldg_Depend_MC</span><span class="p">[</span><span class="s1">&#39;sguid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sguid</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">90</span><span class="p">]:</span>
            <span class="n">day</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">percent_functional</span> <span class="o">=</span> <span class="n">ss_row</span><span class="p">[</span><span class="s1">&#39;func_cascading&#39;</span><span class="o">+</span><span class="n">day</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">percent_functional</span> <span class="o">=</span> <span class="n">percent_functional</span> <span class="k">if</span> <span class="n">percent_functional</span><span class="o">&lt;</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="n">nums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">bldg_rows</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="n">percent_functional</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">percent_functional</span><span class="p">])</span>
            <span class="n">df_EPN_Bldg_Depend_MC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_EPN_Bldg_Depend_MC</span><span class="p">[</span><span class="s1">&#39;sguid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sguid</span><span class="p">,</span> <span class="s1">&#39;func_cascading&#39;</span><span class="o">+</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">nums</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">90</span><span class="p">]:</span>
        <span class="n">day</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">df_EPN_Bldg_functionality</span><span class="p">[</span><span class="s1">&#39;func_cascading&#39;</span><span class="o">+</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_EPN_Bldg_functionality</span><span class="p">[</span><span class="s1">&#39;func_cascading&#39;</span><span class="o">+</span><span class="n">day</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">no_samples</span><span class="p">)</span><span class="o">*</span><span class="n">df_EPN_Bldg_Depend_MC</span><span class="p">[</span><span class="s1">&#39;func_cascading&#39;</span><span class="o">+</span><span class="n">day</span><span class="p">]</span> <span class="o">*</span> <span class="n">df_EPN_Bldg_Depend_MC</span><span class="p">[</span><span class="s1">&#39;bldg_functionality&#39;</span><span class="p">]</span>
    
<span class="n">df_EPN_Bldg_functionality</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>sguid</th>
      <th>nodenwid</th>
      <th>func_cascading1</th>
      <th>func_cascading3</th>
      <th>func_cascading7</th>
      <th>func_cascading30</th>
      <th>func_cascading90</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4014e650-a282-47a0-8b05-be64f92541fe</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
      <td>145</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.19</td>
      <td>0.61</td>
      <td>0.90</td>
    </tr>
    <tr>
      <th>1</th>
      <td>c57a33ff-9cf9-45ec-9c2e-86bba4d585a1</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
      <td>145</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.24</td>
      <td>0.65</td>
      <td>0.82</td>
    </tr>
    <tr>
      <th>2</th>
      <td>398ef608-bcf8-4a15-bfc8-01273c9c36c2</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
      <td>145</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.30</td>
      <td>0.64</td>
      <td>0.88</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0d96300b-0301-41c2-b19c-85a3c8f4c142</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
      <td>145</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.17</td>
      <td>0.70</td>
      <td>0.87</td>
    </tr>
    <tr>
      <th>4</th>
      <td>25e640e5-f6ae-4b6d-a777-4dfcbb818961</td>
      <td>5f5b4d4e-14c9-4d32-9327-81f1c37f5730</td>
      <td>145</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.21</td>
      <td>0.70</td>
      <td>0.85</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>304958</th>
      <td>b378cd1b-d00e-4f0d-9300-163b19b48282</td>
      <td>6a6edd82-02d8-4d5d-9089-9739ab9762ed</td>
      <td>109</td>
      <td>0.83</td>
      <td>0.86</td>
      <td>0.93</td>
      <td>0.97</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>304959</th>
      <td>078f7f26-d519-4909-8d94-76ea2ddcdd92</td>
      <td>6a6edd82-02d8-4d5d-9089-9739ab9762ed</td>
      <td>109</td>
      <td>0.79</td>
      <td>0.87</td>
      <td>0.94</td>
      <td>1.00</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>304960</th>
      <td>35e22845-8567-4cc7-bf92-71f2dba3b70e</td>
      <td>6a6edd82-02d8-4d5d-9089-9739ab9762ed</td>
      <td>109</td>
      <td>0.79</td>
      <td>0.89</td>
      <td>0.95</td>
      <td>0.98</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>304961</th>
      <td>643f77df-8f95-4b61-9209-87a3ede12873</td>
      <td>6a6edd82-02d8-4d5d-9089-9739ab9762ed</td>
      <td>109</td>
      <td>0.89</td>
      <td>0.84</td>
      <td>0.95</td>
      <td>0.99</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>304962</th>
      <td>0becf467-41d6-41ce-9fe4-7600e3dbfcb7</td>
      <td>6a6edd82-02d8-4d5d-9089-9739ab9762ed</td>
      <td>109</td>
      <td>0.83</td>
      <td>0.87</td>
      <td>0.92</td>
      <td>1.00</td>
      <td>1.00</td>
    </tr>
  </tbody>
</table>
<p>304963 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Merge EPN functionality estimates with EPN shapefile for plotting</span>
<span class="n">df_EPN_Bldg_functionality_gdf</span> <span class="o">=</span> <span class="n">bldg_gdf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_EPN_Bldg_functionality</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="results-obtain-for-functionality-of-buildings-by-accounting-for-the-interdependency-between-buildings-and-epn-network">
<h2>4-6) Results obtain for functionality of buildings by accounting for the interdependency between buildings and EPN network<a class="headerlink" href="#results-obtain-for-functionality-of-buildings-by-accounting-for-the-interdependency-between-buildings-and-epn-network" title="Permalink to this heading">#</a></h2>
<p>Example results obtain for functionality of buildings 1 day, 7 days and 30 days after an event</p>
<section id="day-after-event">
<h3>1 Day After Event<a class="headerlink" href="#day-after-event" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">viz</span><span class="o">.</span><span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">df_EPN_Bldg_functionality_gdf</span><span class="p">,</span> <span class="s1">&#39;func_cascading1&#39;</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/acb46793561db8cbeabda4f266157377a81c0b58abe4d6b731311025e1e065be.png" src="../../_images/acb46793561db8cbeabda4f266157377a81c0b58abe4d6b731311025e1e065be.png" />
</div>
</div>
</section>
<section id="days-after-event">
<h3>7 Days After Event<a class="headerlink" href="#days-after-event" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">viz</span><span class="o">.</span><span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">df_EPN_Bldg_functionality_gdf</span><span class="p">,</span> <span class="s1">&#39;func_cascading7&#39;</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/cd12353ef10035934be56b867ee37879c0398fa642da0f50390b200ac9b55eee.png" src="../../_images/cd12353ef10035934be56b867ee37879c0398fa642da0f50390b200ac9b55eee.png" />
</div>
</div>
</section>
<section id="id1">
<h3>30 Days After Event<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">viz</span><span class="o">.</span><span class="n">plot_gdf_map</span><span class="p">(</span><span class="n">df_EPN_Bldg_functionality_gdf</span><span class="p">,</span> <span class="s1">&#39;func_cascading30&#39;</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2f97b6116f66ee0f5a24f281993b83d69d5a844593aff888ef3bb8a05c99a47d.png" src="../../_images/2f97b6116f66ee0f5a24f281993b83d69d5a844593aff888ef3bb8a05c99a47d.png" />
</div>
</div>
</section>
<section id="number-of-buildings-having-functionality-estimates-greater-or-equal-0-5-days-after-event">
<h3>Number of buildings having functionality estimates greater or equal 0.5 days after event<a class="headerlink" href="#number-of-buildings-having-functionality-estimates-greater-or-equal-0-5-days-after-event" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_EPN_Bldg_functionality</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">:]][</span><span class="n">df_EPN_Bldg_functionality</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">:]]</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>func_cascading1      19849
func_cascading3      76486
func_cascading7     263247
func_cascading30    274547
func_cascading90    274547
dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/MMSA_testbed"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="MMSA_Seismic_Functionality_Analysis_for_Interdependent_Buildings-Water-Power_using_Fragility_and_Repair_Rate_Curves.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">MMSA: Seismic Functionality Analysis for Interdependent Buildings-Water-Power using Fragility and Repair Rate Curves</p>
      </div>
    </a>
    <a class="right-next"
       href="../../notebooks_other.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Other Examples</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">MMSA: Seismic Functionality and Restoration Analysis for Interdependent Buildings-Water-Power using Restoration Curves</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#define-earthquake-hazard-scenarios">1) Define Earthquake Hazard Scenarios</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#define-infrastructure-inventory-data">2) Define Infrastructure Inventory Data</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-inventory-data">2-1) Building Inventory Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#structural-system-type-statistics-of-mmsa-building-inventory">Structural system type statistics of MMSA building inventory</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#electric-power-network-epn-inventory-data">2-2) Electric Power Network (EPN) Inventory Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#water-distribution-system-wds-inventory-data">2-3) Water Distribution System (WDS) Inventory Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#epn-service-area-dataset">2-4) EPN service area dataset</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#infrastructure-damage-analysis">3) Infrastructure Damage Analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#buildings-physical-damage-mc-and-functionality-analysis">3-1) Buildings Physical Damage, MC and Functionality Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-damage-analysis">3-1-A) Damage Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#note-the-building-damage-analysis-results-subject-to-mw7-1-is-imported-from-a-csv-file-but-for-the-final-release-the-previous-code-cells-can-be-uncommented-and-use-for-damage-analysis">Note: The building damage analysis results subject to Mw7.1 is imported from a CSV file but for the final release the previous code cells can be uncommented and use for damage analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b-monte-carlo-simulation">3-1-B) Monte Carlo Simulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c-functionality-analysis-buildings-only">3-1-C) Functionality Analysis (Buildings Only)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#electric-power-network-epn-analysis">3-2) Electric Power Network (EPN) Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-epn-damage-analysis">3-2-A) EPN Damage Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b-epn-monte-carlo-analysis">3-2-B) EPN Monte Carlo Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#water-distribution-system-analysis">3-3) Water Distribution System Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-water-facility-wf-damage-analysis">3-3-A) Water Facility (WF) Damage Analysis</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#b-water-facility-wf-mc-simulations">3-3-B) Water Facility (WF) MC Simulations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#c-pipeline-damage-and-servicability-analysis">3-3-C) Pipeline Damage and Servicability Analysis</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#restoration-and-functionality-analysis">4) Restoration and Functionality Analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#networkx-modeling-of-epn-and-wds-networks">4-1) NetworkX Modeling of EPN and WDS networks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#restoration-analysis-of-epn-components">4-2) Restoration Analysis of EPN Components</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#restoration-analysis-of-wds-components">4-3) Restoration Analysis of WDS Components</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#networkx-modeling-of-interdependent-epn-and-wds-networks">4-4) NetworkX modeling of interdependent EPN and WDS networks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-the-epn-and-wds-pecentage-functionality-dataframes-are-combined-in-this-section-to-obtain-an-interdependent-networkx-model-of-epn-and-wds">4-4-A) The EPN and WDS pecentage functionality dataframes are combined in this section to obtain an interdependent networkX model of EPN and WDS.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b-assign-si-values-obtained-from-pipeline-repair-analysis-as-weight-to-networkx-model">4-4-B) Assign SI values obtained from pipeline repair analysis as weight to networkX model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c-define-the-dependency-between-epn-and-wds-with-additional-edges-within-the-networkx-model">4-4-C) Define the dependency between EPN and WDS with additional edges within the networkX model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implemention-of-an-input-output-model-to-estimate-the-functionality-of-epn-nodes-by-accounting-for-dependency-between-epn-and-wds-networks">4-5) Implemention of an Input-Output model to estimate the functionality of EPN nodes by accounting for dependency between EPN and WDS networks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functionality-of-epn-7-and-30-days-after-event">Functionality of EPN 7 and 30 days after event</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-analysisi-of-wds-functionality-estimates-obtained-from-i-o-model">4-5-A) Analysisi of WDS Functionality Estimates obtained from I-O model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results-obtain-for-functionality-of-buildings-by-accounting-for-the-interdependency-between-buildings-and-epn-network">4-6) Results obtain for functionality of buildings by accounting for the interdependency between buildings and EPN network</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#day-after-event">1 Day After Event</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#days-after-event">7 Days After Event</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">30 Days After Event</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-buildings-having-functionality-estimates-greater-or-equal-0-5-days-after-event">Number of buildings having functionality estimates greater or equal 0.5 days after event</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By IN-CORE Community
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>